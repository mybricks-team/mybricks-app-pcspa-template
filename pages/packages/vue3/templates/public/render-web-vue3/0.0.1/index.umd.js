(function(n,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n._mybricks_render_web_vue3={},n.Vue))})(this,function(exports,vue){"use strict";var ft=Object.defineProperty;var dt=(n,e,l)=>e in n?ft(n,e,{enumerable:!0,configurable:!0,writable:!0,value:l}):n[e]=l;var Le=(n,e,l)=>dt(n,typeof e!="symbol"?e+"":e,l);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fn={exports:{}};(function(module,exports){(function(n,e){module.exports=e()})(commonjsGlobal,function(){return function(){var __webpack_modules__={356:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){function __WEBPACK_DEFAULT_EXPORT__(_a){var data=_a.data,outputs=_a.outputs,inputs=_a.inputs,onError=_a.onError;inputs.from(function(val,relOutpus){var _a,script=(_a=data.exchange)===null||_a===void 0?void 0:_a.script;if(script){var fn=void 0,returnVal=void 0,isOk=void 0;try{eval("fn = ".concat(script)),returnVal=fn(val),isOk=!0}catch(n){console.error(n),onError("数据转换错误:".concat(n.message),n)}isOk&&outputs.to(returnVal)}else onError("未配置转换规则")})}__webpack_require__.d(__webpack_exports__,{Z:function(){return __WEBPACK_DEFAULT_EXPORT__}})}},__webpack_module_cache__={};function __webpack_require__(n){var e=__webpack_module_cache__[n];if(e!==void 0)return e.exports;var l=__webpack_module_cache__[n]={exports:{}};return __webpack_modules__[n](l,l.exports,__webpack_require__),l.exports}__webpack_require__.d=function(n,e){for(var l in e)__webpack_require__.o(e,l)&&!__webpack_require__.o(n,l)&&Object.defineProperty(n,l,{enumerable:!0,get:e[l]})},__webpack_require__.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},__webpack_require__.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var __webpack_exports__={};return function(){__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:function(){return me},getCom:function(){return be}});var n=JSON.parse('{"title":"Fn计算","namespace":"mybricks.core-comlib.fn","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"Fn计算","icon":"./icon.png","runtime":"./Fn.tsx","rtType":"js","visibility":false}'),e=JSON.parse('{"visibility":false,"title":"变量","namespace":"mybricks.core-comlib.var","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"变量","icon":"./icon.png","data":"./data.json","runtime":"./Var.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"get","title":"读取","schema":{"type":"any"},"rels":["return"]},{"id":"set","title":"赋值","schema":{"type":"follow"},"rels":["return"]},{"id":"reset","title":"重置","schema":{"type":"any"}}],"outputs":[{"id":"return","title":"完成","schema":{"type":"unknown"}},{"id":"changed","title":"当值发生变化","schema":{"type":"unknown"}}]}');function l(v){if(v)try{var I=Object.prototype.toString.call(v);return["[object Object]","[object Array]"].includes(I)?JSON.parse(JSON.stringify(v)):v}catch{return v}return v}var o=JSON.parse('{"title":"类型转换","visibility":false,"namespace":"mybricks.core-comlib.type-change","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"类型转换","icon":"./icon.png","runtime":"./rt.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"from","title":"从","schema":{"type":"follow"},"rels":["to"]}],"outputs":[{"id":"to","title":"到","schema":{"type":"follow"},"conMax":1,"editable":true}]}'),c=__webpack_require__(356),a=JSON.parse('{"deprecated":true,"visibility":false,"title":"连接器","namespace":"mybricks.core-comlib.connector","author":"MyBricks","author_name":"MyBricks","version":"1.0.0","description":"连接器","runtime":"./runtime.ts","editors":"./editors.tsx","icon":"./icon.svg","rtType":"js-autorun","inputs":[{"id":"call","rels":["then","catch"],"title":"调用","schema":{"type":"object"}}],"outputs":[{"id":"then","title":"结果","schema":{"type":"unknown"}},{"id":"catch","title":"发生错误","schema":{"type":"string"}}]}');function k(v,I){var R=v.env,b=v.data,O=v.outputs;if(v.onError,I===void 0&&(I={}),b.connector)try{R.callConnector(b.connector,I,b.connectorConfig).then(function(B){O.then(B)}).catch(function(B){O.catch(B)})}catch(B){console.error(B),O.catch("执行错误 ".concat(B.message||B))}else O.catch("没有选择接口")}var T=JSON.parse('{"visibility":false,"title":"作用域输入","namespace":"mybricks.core-comlib.frame-input","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"作用域输入","rtType":"js","runtime":"./runtime.ts","editors":"./editor.tsx","inputs":[{"id":"getCurValue","title":"获取","schema":{"type":"any"},"rels":["return"]}],"outputs":[{"id":"return","title":"结果","schema":{"type":"follow"}}]}'),M=JSON.parse('{"visibility":false,"title":"打开对话框","namespace":"mybricks.core-comlib.scenes","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"切换场景","icon":"./icon.png","runtime":"./runtime.ts","data":"./data.json","rtType":"js","inputs":[{"id":"open","title":"打开","schema":{"type":"any"}}]}'),g=JSON.parse('{"title":"模块","namespace":"mybricks.core-comlib.module","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"模块","icon":"./icon.png","data":"./data.json","runtime":"./runtime.tsx","editors":"./editors.ts","outputs":[{"id":"click","title":"单击","description":"点击模块触发的事件","schema":{"type":"any"}}]}'),G=JSON.parse('{"title":"服务Fx","namespace":"mybricks.core-comlib.service","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"服务Fx","icon":"./icon.png","runtime":"./Service.tsx","rtType":"js","visibility":false}'),ke={id:"mybricks-core-comlib",title:"Mybrics核心组件库",author:"CheMingjun",icon:"",version:"1.0.1",comAray:[z({comDef:n,rt:function(v){v.inputs,v.outputs}}),z({comDef:e,rt:function(v){v.env;var I=v.data,R=v.outputs,b=v.inputs,O=v._notifyBindings;b.get(function(B,ne){var j=l(I.val!==void 0?I.val:I.initValue);ne.return(j)}),b.set(function(B,ne){I.val=B;var j=l(B);R.changed(j,!0),O(j),ne.return(j)}),b.reset(function(){var B=I.initValue;I.val=B;var ne=l(B);R.changed(ne,!0),O(ne)})}}),z({comDef:o,rt:c.Z}),z({comDef:a,rt:function(v){var I=v.env,R=v.data,b=v.inputs,O=v.outputs,B=v.onError;I.runtime&&(R.immediate?k({env:I,data:R,outputs:O}):b.call(function(ne){k({env:I,data:R,outputs:O,onError:B},ne)}))}}),z({comDef:T,rt:function(v){var I=v.env,R=v.inputs;I.runtime&&R.getCurValue(function(b,O){O.return(b)})}}),z({comDef:M,rt:function(v){var I=v.env,R=v.data,b=v.inputs,O=(v._inputs,v._inputsCallable);b.open(function(B){I.canvas.open(R._sceneId,B,R._sceneShowType==="popup"?null:R.openType),O._open(B)})}}),z({comDef:g,rt:function(v){var I=v.id,R=v.env,b=v.data,O=v.inputs,B=v.outputs,ne=R.getModuleJSON(b.definedId);return R.renderModule(ne,{ref:function(j){var m=ne.inputs,S=ne.outputs,W=ne.pinRels,d={},P={};Object.entries(W).forEach(function($){var y=$[0],C=$[1],Q=y.split("_rootFrame_-")[1];if(Q){var Z=C[0];d[Q]=Z,P[Z]=!0}});var V=b.configs;for(var A in V)j.inputs[A](V[A]);S.forEach(function($){var y=$.id;P[y]||j.outputs(y,B[y])}),m.forEach(function($){var y=$.id;O[y](function(C,Q){var Z=d[y];Z&&j.outputs(Z,function(Ce){Q[Z](Ce)}),j.inputs[y](C)})}),j.run()},disableAutoRun:!0,outputs:B,rootId:I})}}),z({comDef:G,rt:function(v){v.inputs,v.outputs}})]},me=ke;function be(v){return ke.comAray.find(function(I){return I.namespace===v})}function z(v){var I=v.comDef,R=v.rt,b=v.data;return Object.assign(I,{runtime:R,data:b})}}(),__webpack_exports__}()})})(fn);var fnExports=fn.exports;const coreLib=getDefaultExportFromCjs(fnExports);function logInputVal(n,e,l,o){let c;try{c=JSON.stringify(o)}catch{c=o}console.log(`%c [MyBricks] 输入项 %c ${n||e.title||e.namespace} | ${l} -> ${c}`,"color:#FFF;background:#000","","")}function logOutputVal(n,e,l,o){let c;try{c=JSON.stringify(o)}catch{c=o}console.log(`%c [MyBricks] 输出项 %c ${n||e.title||e.namespace} | ${l} -> ${c}`,"color:#FFF;background:#fa6400","","")}function isNumber(n){return typeof n=="number"&&!isNaN(n)}function compareVersion(n,e){const l=n.split("."),o=e.split("."),c=l.length,a=o.length,k=Math.min(c,a);let T=0;for(T;T<k;T++){let M=parseInt(l[T]),g=parseInt(o[T]);if(M>g)return 1;if(M<g)return-1}if(c>a){for(let M=T;M<c;M++)if(parseInt(l[M])!=0)return 1;return 0}else if(c<a){for(let M=T;M<a;M++)if(parseInt(o[M])!=0)return-1;return 0}return 0}function uuid(n=5,e=8){const l="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(e=e||l.length,n)for(let c=0;c<n;c++)o[c]=l[0|Math.random()*e];else{let c;o[8]=o[13]=o[18]=o[23]="-",o[14]="4";for(let a=0;a<36;a++)o[a]||(c=0|Math.random()*16,o[a]=l[a==19?c&3|8:c])}return o.join("")}function convertCamelToHyphen(n){return n.replace(/([A-Z])/g,"-$1").toLowerCase()}const toFixed=function n(e,l){var o=Math.pow(10,l+1),c=Math.floor(e*o);return Math.round(c/10)*10/o},createPxReplacer=function n(e,l,o,c){return function(a,k){var T=parseFloat(k);return!k||T<=l?a:"".concat(toFixed(T/e,o)).concat(c)}},remReplace=createPxReplacer(12,0,5,"rem"),REG_PX=/"[^"]+"|'[^']+'|url\([^)]+\)|(\d*\.?\d+)px/g,pxToRem=n=>n.replace(REG_PX,remReplace),getPxToVw=({viewportWidth:n=375,unitPrecision:e=5})=>{const l=createPxReplacer(n/100,0,e,"vw");return o=>o.replace(REG_PX,l)};function dataSlim(n){return n}function easyClone(n){if(n&&typeof n=="object")try{return n instanceof FormData?n:JSON.parse(JSON.stringify(n))}catch{return n}return n}function easyDeepCopy(n,e=[]){const l=Object.prototype.toString.call(n);if(n===null||typeof n!="object"||l.startsWith("[object HTML"))return n;const o=e.filter(a=>a.original===n)[0];if(o)return o.copy;const c=Array.isArray(n)?[]:{};return e.push({original:n,copy:c}),Object.keys(n).forEach(a=>{c[a]=deepCopy(n[a],e)}),c}function deepCopy(n,e=[]){const l=Object.prototype.toString.call(n);if(n===null||typeof n!="object"||l.startsWith("[object HTML"))return n;const o=e.filter(a=>a.original===n)[0];if(o)return o.copy;const c=Array.isArray(n)?[]:{};return e.push({original:n,copy:c}),Object.getOwnPropertyNames(n).forEach(a=>{const k=Object.getOwnPropertyDescriptor(n,a);k&&typeof k.get=="function"?Object.defineProperty(c,a,{get:k.get,enumerable:k.enumerable,configurable:k.configurable}):c[a]=deepCopy(n[a],e)}),c}function canNextHackForSameOutputsAndRelOutputs(n,e,l){var a,k;const o=(a=n==null?void 0:n.def)==null?void 0:a.namespace,c=(k=l==null?void 0:l[1])==null?void 0:k.pinHostId;return!(o&&c&&(o==="test.text"&&c==="testOut"||o==="fangzhou.normal-pc.table-blocks"&&c==="rowSelection")&&e.startPinParentKey)}const ROOT_FRAME_KEY="_rootFrame_",generateMissingComponentMessage=n=>`未找到组件(${n.namespace}@${n.version})定义`;function executor(n,e={}){const{observable:l=r=>r}=e,{json:o,getComDef:c,env:a,ref:k,onError:T=()=>{},logger:M=console,debug:g,debugLogger:G,_isNestedRender:ke,_isNestCom:me,_context:be,_getComProps:z,_getSlotValue:v,_frameId:I,rootId:R}=n,b=n.scenesOperate||a.scenesOperate,{_v:O,id:B,slot:ne,coms:j={},comsAutoRun:m={},cons:S=[],pinRels:W={},pinProxies:d={},pinValueProxies:P={},type:V}=o;let A=j;O==="2024-diff"&&(A=new Proxy(j,{get(r,i){var F;const t=r[i];if(!t||t._ready)return t;const{def:f}=t;t._ready=!0;const u=c(f),s=t.model,w=s.data;return w?s.data=Object.assign(easyDeepCopy(u.data),w):s.data=easyDeepCopy(u.data),(F=f.rtType)!=null&&F.match(/^js/gi)||(t.inputs=u.inputs.concat(s.inputAry),t.outputs=u.outputs.concat(s.outputAry)),t}}));const $=a,y={},C={},Q={},Z={},Ce={};Object.keys(S).forEach(r=>{const i=S[r],{startPinParentKey:t}=i[0];t&&(Ce[t]=r)});const Ee={},xe={},x={},q={},D={},ae={},ee={},se={},Pe={},ie=new Var;function le(r,i,t){if(!me){if(r==="com"){const{com:f,pinHostId:u,val:s,fromCon:w,notifyAll:F,comDef:p,conId:E}=i;G?G("com","output",{id:f.id,pinHostId:u,val:s,fromCon:w,notifyAll:F,comDef:p,sceneId:o.id,conId:E},t):logOutputVal(f.title,p,u,s)}else if(r==="frame"){const{comId:f,frameId:u,pinHostId:s,val:w,sceneId:F,conId:p}=i;G&&G("frame","output",{comId:f,frameId:u,pinHostId:s,val:w,sceneId:F||o.id,conId:p},t)}}}function $e(r,i){if(me)return;const{com:t,pinHostId:f,val:u,frameKey:s,finishPinParentKey:w,comDef:F,conId:p}=r;p&&(G?G("com","input",{id:t.id,pinHostId:f,val:u,frameKey:s,finishPinParentKey:w,comDef:F,sceneId:o.id,conId:p},i):logInputVal(t.title,F,f,u))}function Me(r,i,t,f){var w,F,p;const u=d[r.comId+"-"+r.pinId];let s=r;if(u){if(u.type==="myFrame"){const oe=y[`${r.comId}-${u.frameId}`];if(oe){const he=Object.entries(oe);if(he.length===1){const pe=he[0][1];pe.curScope?pe.inputs[u.pinId](t):Pe[`${r.comId}-${u.frameId}`]={pinId:u.pinId,value:t}}else{const pe=he.length>1;Object.entries(oe).forEach(([ye,ce])=>{ye==="slot"&&pe||ce.inputs[u.pinId](t)})}}return}const E=((w=s.def)==null?void 0:w.namespace)==="mybricks.core-comlib.frame-output";if(E)s={...r,type:u.type,frameId:u.frameId,pinId:u.pinId,direction:"inner-input",comId:(r.targetFrameKey||r.frameKey).split("-")[0]};else{if(f&&f.finishPinParentKey!==s.startPinParentKey)return;if(u.type==="frame"){if(s.def.namespace==="mybricks.core-comlib.fn"){const{frameId:ye,comId:ce,pinId:K}=u,te=ce?`${ce}-${ye}`:`${ye}`;if(S[te+"-"+K])executor({...n,_getComProps(H){return J(H,i)},_getSlotValue(H){return Se(H,i)},_frameId:ye,ref:H=>{const Fe=H.getComInfo(s.comId),{configs:_}=Fe.model.data,{frameId:N,pinId:Y}=u,re=Fe.outputs,fe=null;if(re!=null&&re.length){const Oe=J(s.comId,i);re.forEach(we=>{H.outputs(we,He=>{const ze=Oe.outputs[we];ze&&ze(He,i)})})}_&&Object.entries(_).forEach(([Oe,we])=>{H.inputs[Oe](we,void 0,!0,N,fe)}),H.inputs[Y](t,void 0,!0,N,fe),H.run(N,fe)}},e);else if(le("frame",{comId:ce,frameId:ye,pinHostId:K,val:t,sceneId:null}),ye!==ROOT_FRAME_KEY)if(o.id===ye)Z[K](t);else{const H=J(s.comId,i);b==null||b.open({frameId:ye,todo:{pinId:K,value:t},comProps:H,parentScope:H})}return}const he=J(s.comId,i);let pe;pe={id:uuid(10,16),frameId:u.frameId,parent:i,proxyComProps:he},Ie({options:u,value:t,scope:pe,comProps:he}),E||Be({frameId:u.frameId,scope:pe});return}x[`${u.frameId}-${u.pinId}`]=t}}if(s.type==="com")f?f.finishPinParentKey===s.startPinParentKey&&ue(s,t,i):ue(s,t,i);else if(s.type==="frame"){if(f&&f.finishPinParentKey!==s.startPinParentKey)return;if(s.comId&&(u==null?void 0:u.frameId)!==B){if(s.direction==="inner-input"){const E=C[s.comId+"-"+s.frameId+"-"+(i!=null&&i.id?i.id+"-":"")+s.pinId]||C[s.comId+"-"+s.frameId+"-"+((F=i==null?void 0:i.parent)!=null&&F.id?i.parent.id+"-":"")+s.pinId]||C[s.frameKey+"-"+s.pinId];E?E(t):console.log("未找到proxyFn: ",s)}else if(s.direction==="inner-output"&&s.pinType==="joint"){const E=S[s.comId+"-"+s.frameId+"-"+s.pinId];E&&je({logProps:null,cons:E,val:t})}}else{const E=i==null?void 0:i.proxyComProps;if(E){const oe=E.outputs[s.pinId];if(oe){oe(t,i.parent);return}}(p=Z[s.pinId])==null||p.call(Z,t)}}else throw new Error("尚未实现")}function je({logProps:r,cons:i,val:t,curScope:f,fromCon:u,notifyAll:s,fromCom:w,isAutoRun:F}){!me&&g&&i.sort((p,E)=>p.isBreakpoint&&!E.isBreakpoint?-1:!p.isBreakpoint&&E.isBreakpoint?1:0),i.forEach(async p=>{var K,te;const{comId:E,pinId:oe,pinType:he,timerPinInputId:pe,frameKey:ye}=p,ce=A[E];if(u){if(u.finishPinParentKey!==p.startPinParentKey)return}else if(!canNextHackForSameOutputsAndRelOutputs(w,p,r))return;if(!(!me&&g&&p.isIgnored)){if(!me&&g&&((K=be.debuggerPanel)!=null&&K.hasBreakpoint(p))){let X=!0;await((te=be.debuggerPanel)==null?void 0:te.wait(p,()=>{X=!1,r&&(r[1].conId=p.id,r&&le(...r,!0))})),X&&r&&(r[1].conId=p.id,r&&le(...r))}else r&&le(...r);if(he==="timer")L({value:t,curScope:f,inReg:p,notifyAll:s,fromCon:u});else if(s){const X=p.frameKey;if(X===ROOT_FRAME_KEY||F)U({pinId:oe,value:t,component:ce,curScope:null,comId:E,val:t,timerPinInputId:pe,frameKey:X,inReg:p,notifyAll:s,fromCon:u});else{const[H,Fe]=X.split("-");if(q[X]){const _=q[X],N=_[w.id];N?N[p.id]=p:_[w.id]={[p.id]:p}}else{const _=q[X]={};_[w.id]={[p.id]:p}}if(w.parentComId)U({pinId:oe,value:t,component:ce,curScope:f,comId:H,val:t,timerPinInputId:pe,frameKey:X,inReg:p,notifyAll:s,fromCon:u});else{const _=y[`${H}-${Fe}`];if(_){const N=Object.entries(_),Y=N.length;N.forEach(([re,fe])=>{Y>1&&re==="slot"||((fe==null?void 0:fe.type)==="scope"?fe.curScope?U({pinId:oe,value:t,component:ce,curScope:fe.curScope,comId:H,val:t,timerPinInputId:pe,frameKey:X,inReg:p,notifyAll:s,fromCon:u}):fe.pushTodo(Oe=>{U({pinId:oe,value:t,component:ce,curScope:Oe,comId:H,val:t,timerPinInputId:pe,frameKey:X,inReg:p,notifyAll:s,fromCon:u})}):U({pinId:oe,value:t,component:ce,curScope:fe.curScope,comId:H,val:t,timerPinInputId:pe,frameKey:X,inReg:p,notifyAll:s,fromCon:u}))})}}}}else U({pinId:oe,value:t,component:ce,curScope:f,comId:E,val:t,timerPinInputId:pe,frameKey:ye,inReg:p,notifyAll:s,fromCon:u})}})}function L({pinId:r,value:i,curScope:t,inReg:f,notifyAll:u,fromCon:s}){let w=t;const F=r?{...f,pinId:r}:f;if(u){const p=F.frameKey;if(!p)throw new Error("数据异常，请检查toJSON结果.");p===ROOT_FRAME_KEY?Me(F,{},i,s):Me(F,t,i,s)}else{const p=F.frameKey.split("-");if(p.length>=2&&!w){const E=Ke(p[0],p[1],null,!1);(E==null?void 0:E.type)==="scope"?E.curScope?Me(F,E.curScope,i,s):E.pushTodo(oe=>{Me(F,oe,i,s)}):Me(F,w,i,s)}else Me(F,w,i,s)}}function U({pinId:r,value:i,component:t,curScope:f,comId:u,val:s,timerPinInputId:w,frameKey:F,inReg:p,notifyAll:E,fromCon:oe}){const{isReady:he,isMultipleInput:pe,pinId:ye,value:ce,cb:K}=ge({pinId:r,value:i,component:t,curScope:f,comId:u,val:s});if(he){const te={pinId:pe?ye:null,value:ce,curScope:f,inReg:p,notifyAll:E,fromCon:oe};if(w){const X=w+"-"+F+(f!=null&&f.id?`-${f.id}`:""),H=xe[X];if(H){const{ready:Fe,todo:_}=H;if(Fe){let N=!1;Object.entries(_).forEach(([Y,re])=>{Y===ye?(L(te),N=!0):re()}),N||L(te),K==null||K(),Reflect.deleteProperty(xe,X)}else _[ye]=()=>{K==null||K(),L(te)}}else xe[X]={ready:!1,todo:{[ye]:()=>{K==null||K(),L(te)}}}}else K==null||K(),L(te)}}function ge({pinId:r,value:i,component:t,curScope:f,comId:u,val:s}){const w=r.indexOf("."),F={pinId:r,value:i,isReady:!0,isMultipleInput:!1,cb:null};if(t&&w!==-1){const p=t.id+`${f!=null&&f.id?`-${f.id}`:""}`,{inputs:E}=t,oe=r.substring(0,w);F.pinId=oe;const he=r.substring(w+1);let pe=Ee[p];pe||(pe=Ee[p]={}),pe[he]=s;const ye=new RegExp(`${oe}.`),ce=E.filter(K=>!!K.match(ye));Object.keys(pe).length===ce.length?(F.value=pe,F.isMultipleInput=!0,F.cb=()=>{Reflect.deleteProperty(Ee,p)}):F.isReady=!1}return F}function J(r,i,t){var st,ot,ct;const f=A[r];if(!f)return null;const u=f.def,s=(st=u.rtType)==null?void 0:st.match(/^js/gi);if(z&&!s&&!t||z&&u.namespace==="mybricks.core-comlib.var"&&!t)return z(r);const w=r+(f.frameId||ROOT_FRAME_KEY);let F=y[w];F||(F=y[w]={});let p,E=i;!E&&f.parentComId&&f.frameId&&(E=(ct=(ot=y[`${f.parentComId}-${f.frameId}`])==null?void 0:ot.slot)==null?void 0:ct.curScope);let oe;for(;E;){E.dynamicId&&(oe=E.dynamicId);const ve=E.id+"-"+r;if(E.frameId===f.frameId){p=E.id;const de=oe?F[`${p}-${oe}-${r}`]:F[ve];if(de)return de;{const _e=E.parentComId;if(_e){if(_e===f.paramId||_e===f.parentComId)break}else break}}E=E.parent}const he=(p?p+"-":"")+r;if(p){const ve=se[p]||(se[p]={});ve[w]=he}const pe=F[he];if(pe)return pe;const ye=f.model,ce=JSON.parse(JSON.stringify(ye.data)),K=JSON.parse(JSON.stringify(ye.style));K.__model_style__=!0;const te={},X={},H={},Fe=(ve,de,_e,Ae,Ne)=>{let Re=X[ve];Re||(X[ve]=Re=[]),Re.push({val:de,fromCon:_e,fromScope:Ae,next:Ne})},_=function(ve){return new Proxy({},{ownKeys(de){return f.inputs},getOwnPropertyDescriptor(de){return{enumerable:!0,configurable:!0}},get(de,_e){return function(Ae){if(Object.prototype.toString.call(_e)==="[object Symbol]")return;const Ne=ve==null?void 0:ve.inputs;if(Ne){const Ve=Ne[_e];typeof Ve=="function"&&Ve(Ae)}te[_e]=Ae;const Re=X[_e];Re&&(Re.forEach(({val:Ve,fromCon:Je,fromScope:Ye,next:Ge})=>{Ae(Ve,new Proxy({},{get(lt,qe){return function(et){if(Object.prototype.toString.call(qe)==="[object Symbol]")return;const Xe=Ge||re()[qe];if(typeof Xe=="function")Xe(et,Ye||E,Je,!1,qe);else throw new Error(`outputs.${qe} not found`)}}}))}),X[_e]=void 0)}}})},N=new Proxy({},{get(ve,de){return function(_e){if(Object.prototype.toString.call(de)==="[object Symbol]")return;const Ae=W[r+"-"+de];if(Ae){const Ne={},Re={};return Ae.forEach(Ve=>{Ne[Ve]=Je=>{Re[Ve]=Je}}),Promise.resolve().then(()=>{ue({comId:r,def:u,pinId:de},_e,i,Re)}),Ne}else ue({comId:r,def:u,pinId:de},_e,i)}}}),Y=new Proxy({},{get(ve,de){return function(_e){if(Object.prototype.toString.call(de)==="[object Symbol]")return;const Ae=d[r+"-"+de];Ae&&(b==null||b.inputs({...Ae,value:_e,parentScope:ze}))}}}),re=function(ve){return new Proxy({},{ownKeys(de){return f.outputs},getOwnPropertyDescriptor(de){return{enumerable:!0,configurable:!0}},get(de,_e,Ae){const Ne=function(Re,Ve,Je,Ye){if(Object.prototype.toString.call(_e)==="[object Symbol]")return;const Ge=typeof Ve=="boolean"&&Ve;if(Ge){if(f.parentComId){const Ue=`${f.parentComId}-${f.frameId}`;ae[Ue]?ae[Ue][r]=!0:ae[Ue]={[r]:!0}}if(D[`${f.id}${i!=null&&i.id?`-${i.id}`:""}`]=Re,f.global&&!Ye){b==null||b.exeGlobalCom({com:f,value:Re,pinId:_e});return}}const lt=arguments,qe=ve==null?void 0:ve.outputs;if(qe){const Ue=qe[_e];typeof Ue=="function"&&Ue(Re)}let et;Ve&&typeof Ve=="object"&&(et=Ve);const Xe=c(u);if(!Xe){T(generateMissingComponentMessage(u));return}const ut=ye.outputEvents;let We;if(ut){const Ue=ut[_e];if(Ue&&Array.isArray(Ue)){const it=Ue.find(rt=>rt.active);if(it){const{type:rt}=it;switch(rt){case"none":We=[];break;case"fx":const nt=d[r+"-"+_e];if((nt==null?void 0:nt.type)==="frame"){const Ze=`${nt.frameId}-${nt.pinId}`;We=S[Ze]||[],x[Ze]=Re}else We=[];break;case"defined":break;default:if(We=[],Array.isArray(a==null?void 0:a.events)){const Ze=a.events.find(at=>{if(at.type===rt)return at});Ze&&typeof Ze.exe=="function"&&Ze.exe({options:it.options})}break}}}}We=We||S[r+"-"+_e],We!=null&&We.length?lt.length>=3&&typeof Ye>"u"?je({logProps:["com",{com:f,pinHostId:_e,val:Re,fromCon:Je,notifyAll:Ge,comDef:Xe}],cons:We,val:Re,curScope:et,fromCon:Je,fromCom:f}):je({logProps:["com",{com:f,pinHostId:_e,val:Re,fromCon:Je,notifyAll:Ge,comDef:Xe}],cons:We,val:Re,curScope:et||i,fromCon:Je,notifyAll:Ge,fromCom:f}):le("com",{com:f,pinHostId:_e,val:Re,fromCon:Je,notifyAll:Ge,comDef:Xe})};return Ne.getConnections=()=>S[r+"-"+_e]||[],Ne}})},fe=new Proxy({},{get(ve,de,_e){return function(Ae){if(Object.prototype.toString.call(de)==="[object Symbol]")return;const Ne=H[de];Ne&&(Ne.forEach(Re=>{Ae(Re)}),H[de]=void 0)}}}),Oe=new Proxy({},{get(ve,de,_e){return function(Ae){if(Object.prototype.toString.call(de)==="[object Symbol]")return;const Ne=S[r+"-"+de];Ne?je({logProps:["com",{com:f,pinHostId:de,val:Ae,comDef:u}],cons:Ne,val:Ae,curScope:i}):le("com",{com:f,pinHostId:de,val:Ae,comDef:u})}}});function we(ve){f.global?b.var.changed(r,ve):ie.changed(r,ve)}let He=new Set,ze={id:f.id,title:f.title,frameId:f.frameId,parentComId:f.parentComId,data:s?ce:l(ce),style:s?K:l(K),_inputRegs:te,addInputTodo:Fe,inputs:_(),inputsCallable:N,_inputsCallable:Y,outputs:re(),_inputs:fe,_outputs:Oe,clone(ve){const de={inputs:_(ve),outputs:re(ve)};return Object.setPrototypeOf(de,this),de},_notifyBindings:we,logger:M,destroy:()=>{ze=null,He.forEach(({id:ve,callBack:de,global:_e})=>{_e?b.var.destroy(ve,de):ie.destroy(ve,de)})},onError:g?ve=>T({comId:r,error:ve,title:f.title}):T};F[he]=ze;const{bindingsFrom:Qe}=f.model;return Qe&&Object.entries(Qe).forEach(([ve,de])=>{const _e=j[de],Ae=Ne=>{let Re=ze;const Ve=ve.split(".");Ve.forEach((Je,Ye)=>{Ye!==Ve.length-1?Re=Re[Je]:Re[Je]=Ne})};_e.global?(He.add({id:de,callBack:Ae,global:!0}),b.var.regist(de,Ae)):(He.add({id:de,callBack:Ae}),ie.regist(de,Ae))}),ze}function Se(r,i){let t=x[`${r}${i?`-${i.id}-${i.frameId}`:""}`];return typeof t>"u"&&(i!=null&&i.parent)&&(t=Se(r,i.parent)),easyClone(t)}function ue(r,i,t,f){var pe,ye,ce;const{comId:u,def:s,pinId:w,pinType:F,frameKey:p,finishPinParentKey:E,timerPinInputId:oe,targetFrameKey:he}=r;if(F==="ext"){const K=y[u]||J(u,t);if(w==="_setStyle"){const X=R?`${R}-${u}`:u;(ye=(pe=be==null?void 0:be.options)==null?void 0:pe.stylization)==null||ye.setStyle(X,i)}else{const X=K.style;let H=X.display;w==="show"?H="":w==="hide"?H="none":w==="showOrHide"&&(typeof i>"u"?H==="none"?H="":H="none":H=i?"":"none"),X.display=H}const te=c(s);if(!te){T(generateMissingComponentMessage(s));return}$e({com:K,val:i,pinHostId:w,frameKey:p,finishPinParentKey:E,comDef:te,conId:r.id})}else if(F==="config"){const K=J(u,t),te=c(s);if(!te){T(generateMissingComponentMessage(s));return}$e({com:K,pinHostId:w,val:i,frameKey:p,finishPinParentKey:E,comDef:te,conId:r.id});const{extBinding:X}=r,H=X.split(".");let Fe=K;H.forEach((_,N)=>{N!==H.length-1?Fe=Fe[_]:Fe[_]=i})}else if(F==="timer"){const K=J(u,t),te=c(s);if(!te){T(generateMissingComponentMessage(s));return}$e({com:K,pinHostId:w,val:i,frameKey:p,finishPinParentKey:E,comDef:te,conId:r.id});const X=oe+"-"+p+(t!=null&&t.id?`-${t.id}`:""),H=xe[X];if(H){const{todo:Fe}=H;Object.entries(Fe).forEach(([_,N])=>N()),Reflect.deleteProperty(xe,X)}else xe[X]={ready:!0,todo:{}}}else if((ce=s.rtType)!=null&&ce.match(/^js/gi)){const K=A[u];if(K){const te=J(u,t),X=c(s);if(!X){T(generateMissingComponentMessage(s));return}if(K.global){const N=b==null?void 0:b.getGlobalComProps(u);N&&(te.data.val=N.data.val)}const H=t==null?void 0:t.id,Fe=(H?H+"-":"")+u;K.inputs.find(N=>N===w)?$e({com:K,val:i,pinHostId:w,frameKey:p,finishPinParentKey:E,comDef:X,conId:r.id}):Object.entries(i).forEach(([N,Y])=>{$e({com:K,val:Y,pinHostId:`${w}.${N}`,frameKey:p,finishPinParentKey:E,comDef:X,conId:r.id})}),Q[Fe]||(Q[Fe]=!0,X.runtime({env:$,data:te.data,inputs:te.inputs,outputs:te.outputs,_notifyBindings:te._notifyBindings,_inputsCallable:te._inputsCallable,logger:M,onError:g?N=>T({comId:u,error:N,title:K.title}):T}));const _=te._inputRegs[w];typeof _=="function"?_(i,new Proxy({},{get(N,Y){return function(re){if(Object.prototype.toString.call(Y)!=="[object Symbol]"){if(P){const fe=P[`${u}-${w}`];if(fe){const Oe=fe.frameId,we=`${Oe===o.id?ROOT_FRAME_KEY:he||p}-${fe.pinId}`,He=Oe===I?Se:v||Se;re=He(we,t),typeof re>"u"&&(re=He(we,null))}}z?J(u,t,!0).outputs[Y](re,t,r):te.outputs[Y](re,t,r)}}}})):(console.log("计算组件的addInputTodo: ",s),te.addInputTodo(w,i,r,t))}}else{const K=J(u,t);if(!K)return;const te=c(s);if(!te){T(generateMissingComponentMessage(s));return}$e({com:K,pinHostId:w,val:i,frameKey:p,finishPinParentKey:E,comDef:te,conId:r.id});const X=K._inputRegs[w];if(typeof X=="function"){let H;f?H=f:H=new Proxy({},{get(Fe,_){return function(N){Object.prototype.toString.call(_)!=="[object Symbol]"&&(z?J(u,t,!0).outputs[_](N,t,r):K.outputs[_](N,t,r))}}}),X(i,H)}else K.addInputTodo(w,i,r,t,z?(H,Fe,_,N,Y)=>{J(u,t,!0).outputs[Y](H,t,r)}:null)}if(E){const K=S[Ce[E]];K&&!W[`${u}-${w}`]&&je({logProps:null,cons:K,val:void 0})}}function Te(r,i){let t;return r!=null&&r.comAry&&r.comAry.find(f=>{if(f.id===i)return t=f,f;if(f.slots){for(let u in f.slots)if(t=Te(f.slots[u],i),t)return t}}),t}function Ke(r,i,t,f){var oe;const u=typeof i!="string",s=u?i.id:i,w=`${r}-${s}`;let F=y[w];F||(F=y[w]={});let p=t?t.id:"slot",E=F[p];if(f&&!E&&console.log("不应该再走到这儿了: ",{comId:r,slotId:s,scope:t,notifyAll:f}),!E){let he=u?i:ee[`${r}-${s}`];if(!he){const _=Te(ne,r);if(!(_!=null&&_.slots))return null;he=_==null?void 0:_.slots[s]}const pe={};let ye;if(t){const _=y[r+"-"+s];_&&(ye=_.todo)}const ce={scope:t,todo:ye},K=new Proxy({},{get(_,N){return function(Y){Object.prototype.toString.call(N)!=="[object Symbol]"&&(pe[N]=Y)}}}),te=new Set,X=new Proxy({},{get(_,N){const Y=function(re,fe){if(Object.prototype.toString.call(N)==="[object Symbol]")return;let Oe=fe||ce.scope;const we=r+"-"+s+"-"+N,He=S[we],ze=`${we}${Oe?`-${Oe.id}-${Oe.frameId}`:""}`;te.add(ze),x[ze]=re,He?je({logProps:["frame",{comId:r,frameId:s,pinHostId:N,val:re}],cons:He,val:re,curScope:Oe}):le("frame",{comId:r,frameId:s,pinHostId:N,val:re})};return Y.getConnections=()=>S[r+"-"+s+"-"+N]||[],Y}}),H=new Proxy({},{get(_,N,Y){return function(re){var fe;Object.prototype.toString.call(N)!=="[object Symbol]"&&(C[`${r}-${s}-${t==null?void 0:t.id}-${N}`]=re,C[`${r}-${s}-${(fe=t==null?void 0:t.parent)==null?void 0:fe.id}-${N}`]=re,C[p+"-"+N]=re,C[w+"-"+N]=re)}}});let Fe={};if(E=F[p]={type:he==null?void 0:he.type,run(_,N){let Y=ce.scope;if(_&&Y!==_&&(ce.scope=_,Y=_),N){const fe=Pe[`${r}-${Y.frameId}`];if(fe){const{pinId:Oe,value:we}=fe;E.inputs[Oe](we)}return}const re=(Y==null?void 0:Y.id)||"none";if(Fe[re]||(Fe[re]=!0,Be({comId:r,frameId:s,scope:Y})),Array.isArray(ce.todo)&&(ce.todo.forEach(fe=>{Promise.resolve().then(()=>{fe(Y)})}),ce.todo=void 0),Y&&p!=="slot"){const fe=`${r}-${s}`,Oe=q[fe];Promise.resolve().then(()=>{Oe&&Object.entries(Oe).forEach(([we,He])=>{if(!A[we].parentComId){const Qe=Object.entries(He).map(([st,ot])=>ot);Qe.length&&je({logProps:null,cons:Qe,val:D[we],curScope:Y,notifyAll:!0,fromCom:A[we],isAutoRun:!0})}})})}},destroy(){if(t){let _=!1;const N=t.parent;if(N&&se[N.id]||(_=!0),_){const fe=se[t.id];fe&&(Object.entries(fe).forEach(([Oe,we])=>{Reflect.deleteProperty(Q,we),y[Oe][we]&&!y[Oe][we].setSlotValue&&y[Oe][we].destroy(),Reflect.deleteProperty(y[Oe],we)}),Reflect.deleteProperty(se,t.id))}Reflect.deleteProperty(F,`${t.id}-${t.frameId}`);const Y=`${t.parentComId}-${t.frameId}`,re=ae[Y];re&&Object.keys(re).forEach(fe=>{Reflect.deleteProperty(D,`${fe}-${t.id}`)}),Reflect.deleteProperty(Pe,`${r}-${t.frameId}`)}te.forEach(_=>{Reflect.deleteProperty(x,_)}),Reflect.deleteProperty(F,p),E=null},_inputs:K,_inputRegs:pe,inputs:X,outputs:H,get curScope(){return ce.scope},setCurScope(_){ce.scope=_},get todo(){return ce.todo},pushTodo(_){ce.todo||(ce.todo=[]),ce.todo.push(_)},setSlotValue(_,N){const Y=N||ce.scope;Object.entries(_).forEach(([re,fe])=>{const we=`${r+"-"+s+"-"+re}${Y?`-${Y.id}-${Y.frameId}`:""}`;te.add(we),x[we]=fe})}},t){const _=se[oe=t.id.split("-")[0]]||(se[oe]={});_[w]=p}}return E}function Be(r){const{comId:i,frameId:t,scope:f}=r,u=i?`${i}-${t}`:`${t}`,s=m[u];s&&s.forEach(w=>{const{id:F,def:p}=w,E=A[F];if(E){const oe=J(F,f),he=c(p);if(!he){T(generateMissingComponentMessage(p));return}he.runtime({env:$,data:oe.data,inputs:oe.inputs,outputs:oe.outputs,_inputsCallable:oe._inputsCallable,logger:M,onError:g?pe=>T({comId:F,error:pe,title:E.title}):T})}})}function Ie({options:r,value:i,scope:t=void 0,log:f=!0,comProps:u}){const{frameId:s,comId:w,pinId:F,sceneId:p}=r,E=w?`${w}-${s}`:`${s}`,oe=S[E+"-"+F];x[`${s}-${F}`]=i,oe?je({logProps:["frame",{comId:w,frameId:s,pinHostId:F,val:i,sceneId:p}],cons:oe,val:i,curScope:t}):(f&&le("frame",{comId:w,frameId:s,pinHostId:F,val:i,sceneId:p}),s!==ROOT_FRAME_KEY&&(o.id===s?Z[F](i):b==null||b.open({frameId:s,todo:{pinId:F,value:i},comProps:u,parentScope:t.proxyComProps})))}const De={get({comId:r,slotId:i,slot:t,scope:f,_ioProxy:u}){let s;if(u&&(u.inputs||u.outputs||u._inputs||u._outputs)&&(s=u),i)return t&&(ee[`${r}-${i}`]=t),Ke(r,t||i,f);{const w=J(r,f);return s?w.clone(s):w}},getComInfo(r){return A[r]}};if(typeof k=="function"){const r={style:ne==null?void 0:ne.style,run(i=ROOT_FRAME_KEY,t=null){Be({frameId:i,scope:t})},inputs:new Proxy({},{get(i,t){return function(f,u=void 0,s=!0,w=ROOT_FRAME_KEY,F=null){var p;if(Object.prototype.toString.call(t)!=="[object Symbol]"){if((p=o.inputs)!=null&&p.length){const[E,oe]=t.split("&execute&");if(oe){const he=W[`${ROOT_FRAME_KEY}-${E}`];if(he){executor({...n,_getComProps(ye){return J(ye,null)},_getSlotValue(ye){return Se(ye,null)},_frameId:w,ref:ye=>{const{inputs:ce,outputs:K}=ye;he.forEach(te=>{K(te,(...X)=>{const H=`${te}&execute&${oe}`;Z[H](...X),Reflect.deleteProperty(Z,H)})}),ce[E](f)}},e);return}}}Ie({options:{frameId:w,pinId:t,sceneId:u},value:f,scope:F,log:s})}}}}),outputs(i,t){Z[i]=t},get:De.get,getComInfo:De.getComInfo};k(r)}return De}class Var{constructor(){this._varChangeCallBack=new Map}regist(e,l){let o=this._varChangeCallBack.get(e);o||(o=new Set,this._varChangeCallBack.set(e,o)),o.add(l)}destroy(e,l){const o=this._varChangeCallBack.get(e);o&&o.delete(l)}changed(e,l){const o=this._varChangeCallBack.get(e);o&&o.forEach(c=>{c(l)})}}const MyBricksRenderContext=Symbol("MyBricksRenderContext"),ModuleContext=Symbol("ModuleContext"),_hoisted_1$3=["href","target"],_sfc_main$8=vue.defineComponent({__name:"HintLink",props:{href:{},target:{},style:{},content:{}},setup(n){return(e,l)=>(vue.openBlock(),vue.createElementBlock("div",null,[vue.createElementVNode("a",{href:e.href,target:e.target,style:vue.normalizeStyle(e.style)},vue.toDisplayString(e.content),13,_hoisted_1$3)]))}}),_sfc_main$7=vue.defineComponent({__name:"ComponentNotFound",props:{content:{}},setup(n){return(e,l)=>(vue.openBlock(),vue.createElementBlock("div",{class:vue.normalizeClass(e.classes.error)},vue.toDisplayString(e.content),3))}}),error="_error_1tedd_1",errorRT="_errorRT_1tedd_6",tt="_tt_1tedd_10",info="_info_1tedd_16",style0$2={error,errorRT,tt,info},_export_sfc=(n,e)=>{const l=n.__vccOpts||n;for(const[o,c]of e)l[o]=c;return l},cssModules$2={classes:style0$2},ComponentNotFound=_export_sfc(_sfc_main$7,[["__cssModules",cssModules$2]]),_sfc_main$6=vue.defineComponent({__name:"SlotRender",props:{props:{},slotId:{},slot:{},params:{},style:{},onError:{},createPortal:{},parentComId:{},logger:{},env:{},_env:{},scope:{},getComDef:{},context:{},options:{}},setup(n){const{ref:e,watch:l,onBeforeUnmount:o}=window.Vue,c=n,{slotId:a,parentComId:k,props:T,slot:M,params:g,scope:G,env:ke,createPortal:me,_env:be,style:z,getComDef:v,context:I,onError:R,logger:b,options:O}=c;let B=c.currentScope;const ne=g==null?void 0:g.scope;ne&&(B={id:ne.id+"-"+ne.frameId,frameId:a,parentComId:id,parent:ne});const j=e(null),m=()=>{const V=!ke.edit;let A=B,$=T,y=!1;if(A||(M==null?void 0:M.type)==="scope"&&(A={id:uuid(10,16),frameId:a,parentComId:k},y=!0),g){const C=g.inputValues;if(typeof C=="object"&&(y?$=I.get({comId:k,slotId:a,scope:A}):(A={...A,id:A.id+"-"+uuid(10,16),parentScope:A},$=I.get({comId:k,slotId:a,scope:A})),V)){$.setSlotValue(C);for(let Q in C)$.inputs[Q](C[Q],A)}}return $.run(A),{curScope:A,curProps:$,isRuntime:V}},{curScope:S,curProps:W,isRuntime:d}=m();l(()=>g==null?void 0:g.inputValues,()=>{if(d){const V=g==null?void 0:g.inputValues;if(V){if(!j.value)j.value=V,W.run(null,!0);else if(typeof V=="object"&&JSON.stringify(j.value)!==JSON.stringify(V)){j.value=V,W.setSlotValue(V);for(let A in V)W.inputs[A](V[A],S);W.run()}}}},{immediate:!0}),o(()=>{W.destroy()});const P={scope:S,env:ke,createPortal:me,_env:be,slot:M,params:g,wrapper:g==null?void 0:g.wrap,template:g==null?void 0:g.itemWrap,getComDef:v,context:I,inputs:g==null?void 0:g.inputs,outputs:g==null?void 0:g.outputs,_inputs:g==null?void 0:g._inputs,_outputs:g==null?void 0:g._outputs,onError:R,logger:b,options:O};return(V,A)=>(vue.openBlock(),vue.createBlock(RenderSlot,vue.normalizeProps(vue.guardReactiveProps(P)),null,16))}}),_hoisted_1$2=["id","data-title","data-namespace","data-nested-id"],_sfc_main$5=vue.defineComponent({inheritAttrs:!1,__name:"RenderCom",props:{com:{},index:{},getComDef:{},context:{},scope:{},props:{},env:{},_env:{},template:{},onError:{},logger:{},createPortal:{},options:{}},setup(n){const{ref:e,inject:l,useCssModule:o,computed:c}=window.Vue,a=n,{com:k,index:T,getComDef:M,context:g,scope:G,props:ke,env:me,_env:be,template:z,onError:v,logger:I,createPortal:R,options:b}=a,{id:O,def:B,name:ne,slots:j={},dynamicId:m}=k,{data:S,title:W,style:d,inputs:P,outputs:V,_inputs:A,_outputs:$,_notifyBindings:y}=ke,{rootId:C}=b;l(ModuleContext);function Q({env:L,style:U,def:ge}){var Ke;const J=(Ke=L==null?void 0:L.themes)==null?void 0:Ke.comThemes;if(!J)return U.styleAry;let Se=U.styleAry;const{themesId:ue}=U,{namespace:Te}=ge;if(ue){if(ue!=="_defined"){const Be=J[Te];if(Array.isArray(Be)){const Ie=Be.find(({id:De})=>De===ue);Ie&&(Se=Ie.styleAry)}}}else{const Be=J[Te];if(Array.isArray(Be)){const Ie=Be.find(({isDefault:De})=>De);Ie&&(Se=Ie.styleAry)}}return Se}(()=>{const{handlePxToVw:L,debug:U,disableStyleInjection:ge,rootId:J,stylization:Se}=b,ue=J?`${J}-${O}`:O;if(!ge&&!Se.hasDefaultStyle(ue)){Se.setDefaultStyle(ue);const Te=Q({env:me,def:B,style:d});Array.isArray(Te)&&Se.setStyle(ue,Te),Reflect.deleteProperty(d,"styleAry"),Reflect.deleteProperty(d,"themesId")}})();const Ce=M(B),Ee=[];k.slots&&Object.entries(k.slots).forEach(([L,U])=>{let ge;G&&(ge={id:G.id+"-"+G.frameId+`${m?"-"+m:""}`,frameId:L,parentComId:O,parent:G,dynamicId:m});const J=g.get({comId:O,slotId:L,slot:U,scope:ge});Ee.push({props:J,currentScope:ge,slotId:L,slot:U,style:d,onError:v,createPortal:R,parentComId:O,logger:I,env:me,_env:be,scope:G,getComDef:M,context:g,options:b})});const x=(()=>{if(a.frameId&&a.parentComId){let L=(G==null?void 0:G.parentScope)||G;const U=g.get({comId:a.parentComId,slotId:a.frameId,scope:L!=null&&L.parent?L:null});if(U)return{get _inputs(){return new Proxy({},{get(ge,J){return U._inputRegs[J]}})}}}})(),q=L=>ae({style:d,id:O,rootId:C},L);function D(L){return L+(isNumber(L)?"px":"")}function ae({style:L,id:U,rootId:ge},J){const Se=[U,J.com];return L.flex===1&&!L._new&&Se.push(J.flex),L.heightAuto&&Se.push(J.comHeightAuto),Se.join(" ")}function ee({style:L}){const U={},{width:ge,height:J,maxWidth:Se,flexX:ue,minWidth:Te,minHeight:Ke,rotation:Be}=L;return!ge&&!ue||(isNumber(ge)?U.width=ge+"px":ge&&(U.width=ge)),isNumber(J)?U.height=J+"px":J&&(U.height=J),Se&&(U.maxWidth=D(Se)),Te&&(U.minWidth=D(Te)),Ke&&(U.minHeight=D(Ke)),isNumber(Be)&&(U.transform=`rotate(${Be}deg)`,U.transformOrigin="center center"),U}function se({style:L}){const{margin:U,marginTop:ge,marginLeft:J,marginRight:Se,marginBottom:ue,paddingTop:Te,paddingLeft:Ke,paddingRight:Be,paddingBottom:Ie}=L;return U?{margin:U}:{marginTop:D(ge),marginLeft:D(J),marginRight:D(Se),marginBottom:D(ue),paddingTop:D(Te),paddingLeft:D(Ke),paddingRight:D(Be),paddingBottom:D(Ie)}}const Pe=ee({style:d}),ie=se({style:d}),le={zIndex:d.zIndex};if(["fixed","absolute"].includes(d.position)){const{top:L,left:U,right:ge,bottom:J}=d;(L||isNumber(L))&&(le.top=isNumber(L)?L+"px":L),(J||isNumber(J))&&(le.bottom=isNumber(J)?J+"px":J),(U||isNumber(U))&&(le.left=isNumber(U)?U+"px":U),(ge||isNumber(ge))&&(le.right=isNumber(ge)?ge+"px":ge),d.position==="fixed"?le.zIndex=1e3:d.position==="absolute"&&(le.zIndex=1)}const $e=c(()=>({display:d.display,visibility:d.visibility,position:d.position,flex:d.flex,flexDirection:d.flexDirection,flexShrink:d.flexShrink,...le,...Pe,...ie,...d.ext||{}})),Me=Ce.runtime;let je={id:m||O,_id:C?`${C}-${O}`:O,env:me,_env:be,data:S,name:ne,title:W,style:d,inputs:P,outputs:V,_inputs:A,_outputs:$,_notifyBindings:y,createPortal:R,parentSlot:x,onError:v,logger:I,_onError_:L=>{throw new Error(L)}};return je={...je,m:{...je,style:d}},(L,U)=>(vue.openBlock(),vue.createElementBlock("div",{id:vue.unref(O),key:vue.unref(O),"data-title":vue.unref(W),"data-namespace":vue.unref(B).namespace,"data-nested-id":vue.unref(C)?`${vue.unref(C)}-${vue.unref(O)}`:vue.unref(O),class:vue.normalizeClass(q(L.classes)),style:vue.normalizeStyle(vue.unref($e))},[(vue.openBlock(),vue.createBlock(vue.resolveDynamicComponent(vue.unref(Me)),vue.normalizeProps(vue.guardReactiveProps(vue.unref(je))),vue.createSlots({_:2},[vue.renderList(Ee,ge=>({name:ge.slotId,fn:vue.withCtx(J=>[vue.createVNode(_sfc_main$6,vue.normalizeProps(vue.guardReactiveProps({...ge,params:J})),null,16)])}))]),1040))],14,_hoisted_1$2))}}),com$1="_com_1xp6y_1",comHeightAuto$1="_comHeightAuto_1xp6y_5",flex$1="_flex_1xp6y_8",style0$1={com:com$1,comHeightAuto:comHeightAuto$1,flex:flex$1},cssModules$1={classes:style0$1},RenderCom=_export_sfc(_sfc_main$5,[["__cssModules",cssModules$1]]),_sfc_main$4=vue.defineComponent({__name:"RenderSmart2",props:{elements:{}},setup(n){return(e,l)=>(vue.openBlock(!0),vue.createElementBlock(vue.Fragment,null,vue.renderList(e.elements,o=>(vue.openBlock(),vue.createBlock(_sfc_main$3,vue.mergeProps({key:o.com.id,ref_for:!0},o),null,16))),128))}}),_hoisted_1$1=["id"],_sfc_main$3=vue.defineComponent({__name:"RenderSmart",props:{com:{},index:{},env:{},getComDef:{},context:{},scope:{},inputs:{},outputs:{},_inputs:{},_outputs:{},_env:{},template:{},onError:{},logger:{},createPortal:{},options:{}},setup(n){var W;const e=n,{com:l,index:o,env:c,getComDef:a,context:k,scope:T,inputs:M,outputs:g,_inputs:G,_outputs:ke,_env:me,template:be,onError:z,logger:v,createPortal:I,options:R}=e,{id:b,style:O}=l,B=(W=l.elements)==null?void 0:W.map(d=>({com:d,index:o,env:c,getComDef:a,context:k,scope:T,inputs:M,outputs:g,_inputs:G,_outputs:ke,_env:me,template:be,onError:z,logger:v,createPortal:I,options:R})),ne=({com:d,env:P,getComDef:V,context:A,scope:$,inputs:y,outputs:C,_inputs:Q,_outputs:Z,index:Ce,_env:Ee,template:xe,onError:x,logger:q,createPortal:D,options:ae})=>{var J,Se;const{id:ee,def:se,name:Pe,child:ie,brother:le,dynamicId:$e}=d,Me=A.getComInfo(ee),{hasPermission:je,permissions:L}=P,U=(Se=(J=Me==null?void 0:Me.model)==null?void 0:J.permissions)==null?void 0:Se.id;if(U&&typeof je=="function"){const ue=je(U);if(!ue||typeof ue!="boolean"&&!ue.permission){const Te=L.find(Be=>Be.id===U);return((ue==null?void 0:ue.type)||(Te==null?void 0:Te.register.noPrivilege))==="hintLink"?{id:ee,name:Pe,jsx:_sfc_main$8,props:{href:(ue==null?void 0:ue.hintLinkUrl)||Te.hintLink,target:"_blank",style:{textDecoration:"underline"},content:(ue==null?void 0:ue.hintLinkTitle)||Te.register.title},style:{}}:void 0}}if(V(se)){const ue=A.get({comId:ee,dynamicId:$e,scope:$?{...$,id:$e?$.id+"-"+$e:$.id,dynamicId:$e}:null,_ioProxy:{inputs:y,outputs:C,_inputs:Q,_outputs:Z}});if(ue){const Te=ee+($?$.id:"")+Ce;return{id:ee,comKey:Te,jsx:RenderCom,props:{com:d,index:Ce,getComDef:V,context:A,scope:$,props:ue,env:P,_env:Ee,template:xe,onError:x,logger:q,createPortal:D,options:ae},brother:le,child:ie,name:Pe,inputs:ue.inputsCallable,style:ue.style,com:d}}else return{id:ee,jsx:ComponentNotFound,props:{content:`未找到组件(${se.namespace}@${se.version} - ${ee})定义.`},name:Pe,style:{}}}else return{id:ee,jsx:ComponentNotFound,props:{content:`未找到组件(${se.namespace}@${se.version})定义.`},name:Pe,style:{}}},j=()=>{let d;const{handlePxToVw:P}=R;return P?(d={},Object.entries(O).forEach(([V,A])=>{const $=typeof A;$==="string"&&A.indexOf("px")!==-1?d[V]=P(A):$==="number"?d[V]=P(`${A}px`):d[V]=A})):d=O,d};let m,S;if(!B){const d=ne({com:l,env:c,getComDef:a,context:k,scope:T,inputs:M,outputs:g,_inputs:G,_outputs:ke,index:o,_env:me,template:be,onError:z,logger:v,createPortal:I,options:R});m=d.jsx,S=d.props}return(d,P)=>vue.unref(B)?(vue.openBlock(),vue.createElementBlock("div",{id:vue.unref(b),key:vue.unref(b),style:vue.normalizeStyle(j())},[vue.createVNode(_sfc_main$4,{elements:vue.unref(B)},null,8,["elements"])],12,_hoisted_1$1)):(vue.openBlock(),vue.createBlock(vue.resolveDynamicComponent(vue.unref(m)),vue.normalizeProps(vue.mergeProps({key:1},vue.unref(S))),null,16))}}),_hoisted_1=["data-slot-id","onclick"],_hoisted_2=["data-slot-id","onclick"],_sfc_main$2=vue.defineComponent({__name:"RenderSlot",props:{scope:{},root:{},slot:{},style:{},createPortal:{},className:{},params:{},inputs:{},outputs:{},_inputs:{},_outputs:{},wrapper:{},template:{},env:{},_env:{},getComDef:{},context:{},onError:{},logger:{},options:{},onClick:{}},setup(n){const e=n,{scope:l,root:o,slot:c,style:a={},createPortal:k,className:T,params:M,inputs:g,outputs:G,_inputs:ke,_outputs:me,wrapper:be,template:z,env:v,_env:I,getComDef:R,context:b,onError:O,logger:B,options:ne,onClick:j}=e,m=({com:$,env:y,getComDef:C,context:Q,scope:Z,inputs:Ce,outputs:Ee,_inputs:xe,_outputs:x,index:q,_env:D,template:ae,onError:ee,logger:se,createPortal:Pe,options:ie})=>{var Ke,Be;const{id:le,def:$e,name:Me,child:je,brother:L,dynamicId:U}=$,ge=Q.getComInfo(le),{hasPermission:J,permissions:Se}=y,ue=(Be=(Ke=ge==null?void 0:ge.model)==null?void 0:Ke.permissions)==null?void 0:Be.id;if(ue&&typeof J=="function"){const Ie=J(ue);if(!Ie||typeof Ie!="boolean"&&!Ie.permission){const De=Se.find(i=>i.id===ue);return((Ie==null?void 0:Ie.type)||(De==null?void 0:De.register.noPrivilege))==="hintLink"?{id:le,name:Me,jsx:_sfc_main$8,props:{href:(Ie==null?void 0:Ie.hintLinkUrl)||De.hintLink,target:"_blank",style:{textDecoration:"underline"},content:(Ie==null?void 0:Ie.hintLinkTitle)||De.register.title},style:{}}:void 0}}if(C($e)){const Ie=Q.get({comId:le,dynamicId:U,scope:Z?{...Z,id:U?Z.id+"-"+U:Z.id,dynamicId:U}:null,_ioProxy:{inputs:Ce,outputs:Ee,_inputs:xe,_outputs:x}});if(Ie){const De=le+(Z?Z.id:"")+q;return{id:le,comKey:De,jsx:RenderCom,props:{com:$,index:q,getComDef:C,context:Q,scope:Z,props:Ie,env:y,_env:D,template:ae,onError:ee,logger:se,createPortal:Pe,options:ie},brother:L,child:je,name:Me,inputs:Ie.inputsCallable,style:Ie.style,com:$}}else return{id:le,jsx:ComponentNotFound,props:{content:`未找到组件(${$e.namespace}@${$e.version} - ${le})定义.`},name:Me,style:{}}}else return{id:le,jsx:ComponentNotFound,props:{content:`未找到组件(${$e.namespace}@${$e.version})定义.`},name:Me,style:{}}};let S;const W=[];c.style.layout==="smart"&&c.layoutTemplate?S=c.layoutTemplate.map(($,y)=>({com:$,index:y,env:v,getComDef:R,context:b,scope:l,inputs:g,outputs:G,_inputs:ke,_outputs:me,_env:I,template:z,onError:O,logger:B,createPortal:k,options:ne})):c.comAry.forEach(($,y)=>{const C=m({com:$,env:v,getComDef:R,context:b,scope:l,inputs:g,outputs:G,_inputs:ke,_outputs:me,index:y,_env:I,template:z,onError:O,logger:B,createPortal:k,options:ne});C&&W.push(C)});const d=($,y)=>{const{style:C}=c;let Q;if(y==="smart"){const{rowGap:Z,layout:Ce,position:Ee,justifyContent:xe,flexWrap:x,flexDirection:q,display:D,columnGap:ae,alignItems:ee,...se}=(M==null?void 0:M.style)||{};Q=Object.assign(se||{},C)}else{const Z=M==null?void 0:M.style;Q=Object.assign(c.style,Z||{})}return`${V(Q,$)}${o&&T?` ${T}`:""}`},P=$=>{const{style:y}=c;let C,Q;if($==="smart"){const{rowGap:Z,layout:Ce,position:Ee,justifyContent:xe,flexWrap:x,flexDirection:q,display:D,columnGap:ae,alignItems:ee,...se}=(M==null?void 0:M.style)||{};C=se,Q=Object.assign(C||{},y)}else C=M==null?void 0:M.style,Q=Object.assign(y,C||{});return{...A(Q,!!C||c.type==="module",o,c.type==="module",ne),...a}};function V($,y){var Z,Ce;const C=[y.slot,"slot"],Q=$;if(Q){((Z=Q.layout)==null?void 0:Z.toLowerCase())=="flex-column"?C.push(y.lyFlexColumn):((Ce=Q.layout)==null?void 0:Ce.toLowerCase())=="flex-row"&&C.push(y.lyFlexRow);const Ee=Q.justifyContent;Ee&&(Ee.toUpperCase()==="FLEX-START"?C.push(y.justifyContentFlexStart):Ee.toUpperCase()==="CENTER"?C.push(y.justifyContentFlexCenter):Ee.toUpperCase()==="FLEX-END"?C.push(y.justifyContentFlexFlexEnd):Ee.toUpperCase()==="SPACE-AROUND"?C.push(y.justifyContentFlexSpaceAround):Ee.toUpperCase()==="SPACE-BETWEEN"&&C.push(y.justifyContentFlexSpaceBetween));const xe=Q.alignItems;xe&&(xe.toUpperCase()==="FLEX-START"?C.push(y.alignItemsFlexStart):xe.toUpperCase()==="CENTER"?C.push(y.alignItemsFlexCenter):xe.toUpperCase()==="FLEX-END"&&C.push(y.alignItemsFlexFlexEnd))}return C.join(" ")}function A($,y,C,Q,Z){const{handlePxToVw:Ce}=Z,{paddingLeft:Ee,paddingTop:xe,paddingRight:x,paddingBottom:q,background:D,backgroundColor:ae,backgroundImage:ee,backgroundPosition:se,backgroundRepeat:Pe,backgroundSize:ie,position:le,rowGap:$e,columnGap:Me,borderBottomColor:je,borderBottomLeftRadius:L,borderBottomRightRadius:U,borderBottomStyle:ge,borderBottomWidth:J,borderLeftColor:Se,borderLeftStyle:ue,borderLeftWidth:Te,borderRightColor:Ke,borderRightStyle:Be,borderRightWidth:Ie,borderTopColor:De,borderTopLeftRadius:r,borderTopRightRadius:i,borderTopStyle:t,borderTopWidth:f,boxShadow:u,top:s,left:w,marginLeft:F,marginTop:p,marginRight:E,marginBottom:oe,overflowX:he,overflowY:pe,height:ye,heightAuto:ce,heightFull:K,width:te,widthAuto:X,widthFull:H,...Fe}=$;let _={rowGap:$e,columnGap:Me,paddingLeft:Ee||0,paddingTop:xe||0,paddingRight:x||0,paddingBottom:q||0,backgroundColor:ae||(C?"#ffffff":void 0),backgroundImage:ee,backgroundPosition:se,backgroundRepeat:Pe,backgroundSize:ie,borderBottomColor:je,borderBottomLeftRadius:L,borderBottomRightRadius:U,borderBottomStyle:ge,borderBottomWidth:J,borderLeftColor:Se,borderLeftStyle:ue,borderLeftWidth:Te,borderRightColor:Ke,borderRightStyle:Be,borderRightWidth:Ie,borderTopColor:De,borderTopLeftRadius:r,borderTopRightRadius:i,borderTopStyle:t,borderTopWidth:f,boxShadow:u,overflowX:he,overflowY:pe};if(D)if(typeof D=="object"){const{background:Y,backgroundImage:re,backgroundColor:fe,backgroundRepeat:Oe,backgroundSize:we}=D;_.backgroundRepeat=Oe,_.backgroundSize=we,Y?_.background=Y:(_.backgroundImage=re,_.backgroundColor=fe)}else _.background=D;return Q&&(ce?_.height="fit-content":K?_.height="100%":_.height=ye,X?_.width="fit-content":H?_.width="100%":_.width=te),y&&(_=Object.assign(_,Fe)),Ce&&Object.entries(_).forEach(([N,Y])=>{const re=typeof Y;re==="string"&&Y.indexOf("px")!==-1?_[N]=Ce(Y):re==="number"?_[N]=Ce(`${Y}px`):_[N]=Y}),_}return($,y)=>vue.unref(c).style.layout==="smart"&&vue.unref(S)?(vue.openBlock(),vue.createElementBlock("div",{key:0,"data-isslot":1,"data-slot-id":vue.unref(c).id,onclick:vue.unref(j),class:vue.normalizeClass(d($.classes,"smart")),style:vue.normalizeStyle(P("smart"))},[(vue.openBlock(!0),vue.createElementBlock(vue.Fragment,null,vue.renderList(vue.unref(S),C=>(vue.openBlock(),vue.createBlock(_sfc_main$3,vue.mergeProps({key:C.index,ref_for:!0},C),null,16))),128))],14,_hoisted_1)):(vue.openBlock(),vue.createElementBlock("div",{key:1,"data-isslot":1,"data-slot-id":vue.unref(c).id,onclick:vue.unref(j),class:vue.normalizeClass(d($.classes)),style:vue.normalizeStyle(P())},[(vue.openBlock(),vue.createElementBlock(vue.Fragment,null,vue.renderList(W,C=>vue.createVNode(vue.resolveDynamicComponent(C.jsx),vue.mergeProps({key:C.comkey,ref_for:!0},C.props),null,16)),64))],14,_hoisted_2))}}),slot="_slot_u07rl_1",lyFlexColumn="_lyFlexColumn_u07rl_6",lyFlexRow="_lyFlexRow_u07rl_10",justifyContentFlexStart="_justifyContentFlexStart_u07rl_14",justifyContentFlexCenter="_justifyContentFlexCenter_u07rl_17",justifyContentFlexFlexEnd="_justifyContentFlexFlexEnd_u07rl_20",justifyContentFlexSpaceAround="_justifyContentFlexSpaceAround_u07rl_23",justifyContentFlexSpaceBetween="_justifyContentFlexSpaceBetween_u07rl_26",alignItemsFlexStart="_alignItemsFlexStart_u07rl_29",alignItemsFlexCenter="_alignItemsFlexCenter_u07rl_32",alignItemsFlexFlexEnd="_alignItemsFlexFlexEnd_u07rl_35",debugFocus="_debugFocus_u07rl_38",com="_com_u07rl_42",comHeightAuto="_comHeightAuto_u07rl_46",flex="_flex_u07rl_49",style0={slot,lyFlexColumn,lyFlexRow,justifyContentFlexStart,justifyContentFlexCenter,justifyContentFlexFlexEnd,justifyContentFlexSpaceAround,justifyContentFlexSpaceBetween,alignItemsFlexStart,alignItemsFlexCenter,alignItemsFlexFlexEnd,debugFocus,com,comHeightAuto,flex},cssModules={classes:style0},RenderSlot=_export_sfc(_sfc_main$2,[["__cssModules",cssModules]]),_sfc_main$1=vue.defineComponent({__name:"MMain",props:{json:{},options:{},style:{},className:{},root:{},from:{},ModuleContext:{},MyBricksRenderContext:{}},setup(n){const{ref:e,provide:l,inject:o,watchEffect:c}=window.Vue,a=n;let k,T;a.MyBricksRenderContext?(l(MyBricksRenderContext,a.MyBricksRenderContext),k=a.MyBricksRenderContext):k=o(MyBricksRenderContext),a.ModuleContext?(l(ModuleContext,a.ModuleContext),T=a.ModuleContext):T=o(ModuleContext);const{json:M,options:g,style:G={},className:ke="",root:me=!0,from:be}=a,z=()=>{const{debug:W}=g,{env:d}=T,P=M.slot;if(!d.canvas.isValid&&!g._isNestedRender&&W&&be==="scene"&&P&&P.type!=="module"&&P.showType!=="module"&&(G.flex=1),(P==null?void 0:P.showType)==="module"||(P==null?void 0:P.type)==="module"){const{style:V}=P;G.hasOwnProperty("height")||(V.heightAuto?G.height="fit-content":V.heightFull?G.height="100%":G.height=V.height),G.hasOwnProperty("width")||(V.widthAuto?G.width="fit-content":V.widthFull?G.width="100%":G.width=V.width),P.style.backgroundColor=P.style.backgroundColor||"#ffffff00"}return M.type==="module"&&(P.style.backgroundColor=P.style.backgroundColor||"#ffffff00"),k._v==="2024-diff"&&(M._v=k._v),{env:d,onError:k.onError,logger:k.logger,getComDef:V=>k.getComDef(V),slot:P,_context:k}},{env:v,onError:I,logger:R,slot:b,getComDef:O}=z(),B=()=>{var W;try{let d,P=!0;return[executor({json:M,getComDef:O,events:g.events,env:v,ref(A){d=A,typeof g.ref=="function"&&(g.ref(A),P=!1)},onError:I,debug:g.debug,debugLogger:g.debugLogger,logger:R,scenesOperate:g.scenesOperate,_isNestedRender:g._isNestedRender,_isNestCom:g._isNestCom,_context:k,rootId:g.rootId},{observable:k.observable}),d,P]}catch(d){throw console.error(d),Notification.error(`导出的JSON.script执行异常: ${(d==null?void 0:d.stack)||(d==null?void 0:d.message)||((W=d==null?void 0:d.toString)==null?void 0:W.call(d))}`),new Error("导出的JSON.script执行异常.")}},[ne,j,m]=B();c(()=>{if(!g.disableAutoRun){if(m){const{inputs:W}=j,d=M.inputs;W&&Array.isArray(d)&&d.forEach(P=>{const{id:V,mockData:A,type:$,extValues:y}=P;let C;if(g.debug)if($==="config"&&(y!=null&&y.config)&&"defaultValue"in y.config)try{C=JSON.parse(decodeURIComponent(y.config.defaultValue))}catch{C=y.config.defaultValue}else try{C=JSON.parse(decodeURIComponent(A))}catch{C=A}W[V](C)})}j.run()}},{flush:"post"});const S={env:v,style:G,_env:g._env,slot:b,getComDef:O,context:ne,className:ke,createPortal:g.createPortal||(()=>{}),onError:I,logger:R,root:me,options:g,...M.type==="module"?{onClick(){var W;(W=g.outputs)==null||W.click()}}:{}};return(W,d)=>(vue.openBlock(),vue.createBlock(RenderSlot,vue.normalizeProps(vue.guardReactiveProps(S)),null,16))}}),_sfc_main=vue.defineComponent({__name:"MMultiScene",props:{json:{},options:{},ModuleContext:{},MyBricksRenderContext:{}},setup(n){const{ref:e,provide:l,inject:o,computed:c}=window.Vue,a=n;let k,T;a.MyBricksRenderContext?(l(MyBricksRenderContext,a.MyBricksRenderContext),k=a.MyBricksRenderContext):k=o(MyBricksRenderContext),a.ModuleContext?(l(ModuleContext,a.ModuleContext),T=a.ModuleContext):T=o(ModuleContext);const M=e({count:0,popupIds:[],pageScenes:[]}),g=j=>{M.value.pageScenes=j},G=j=>{M.value.popupIds=j},ke=j=>{M.value.count=j};function me(j,m,S,W){const d=j.get({comId:m});d&&Array.isArray(S)&&S.forEach(P=>{let V=d;const A=P.split(".");A.forEach(($,y)=>{y!==A.length-1?V=V[$]:V[$]=W})})}const be=()=>{const{json:j,options:m}=a,{sceneId:S,disableAutoRun:W,globalVariable:d}=m,{env:P}=T;if(S){const x=j.scenes.findIndex(q=>q.id===S);if(x!==-1){const q=j.scenes.splice(x,1);j.scenes.unshift(...q),q[0].type==="popup"&&G([q[0].id])}}const V=[];j.scenes.forEach((x,q)=>{x.type==="popup"?q||G([x.id]):V.push(x)}),g(V);const{modules:A,definedComs:$,global:y}=j;P.getDefinedComJSON||(P.getDefinedComJSON=x=>$[x].json),P.getModuleJSON=x=>{var q;return(q=A==null?void 0:A[x])==null?void 0:q.json};const C=j.permissions||[];P.themes=j.themes,P.permissions=C;const Q=P.hasPermission;typeof Q=="function"&&Object.defineProperty(P,"hasPermission",{get:function(){return x=>{if(typeof x=="string"){const q=C.find(D=>D.id===x);return Q({permission:q})}return Q(x)}}});const Z={};y.fxFrames.forEach(x=>{Z[x.id]=x});const Ce=j.scenes[0],Ee={lastSceneId:Ce.type==="popup"?null:Ce.id};P.canvas.open=async(x,q,D,ae)=>{var se,Pe;let ee=z[x];if(!ee){if(typeof m.scenesLoader!="function"){P.history?P.history.go(x,q,D):console.error(`缺少场景信息: ${x}`);return}const ie=await m.scenesLoader({id:x});if(ee={disableAutoRun:!1,json:ie,show:!1,parentScope:null,todo:[],type:((se=ie.slot)==null?void 0:se.showType)||ie.type,useEntryAnimation:!1},z[x]=ee,ie.type==="popup"?console.log(""):g(le=>[...le,ie]),v[x]){const{parentScope:le,todo:$e}=v[x];ee.parentScope=le,$e.forEach(({value:Me,pinId:je,parentScope:L})=>{ee.todo=ee.todo.concat({type:"inputs",todo:{pinId:je,value:Me}})})}}if((Pe=m.scenesLoaded)==null||Pe.call(m,ee.json),D)if(D==="popup"&&(ee.disableAutoRun=!1),D==="none")z[x].show=!0,ke(ie=>ie+1);else{const ie=z[Ee.lastSceneId],le=z[x];D==="blank"&&m.sceneOpenType!=="redirect"?le.useEntryAnimation=!0:le.useEntryAnimation=!1,le.show=!0,le.hidden=!1,ie&&ie.json.id!==le.json.id&&(ae?ae==="back"?(ie.show=!1,ie._refs=null,ie.alreadyOpened=!1):(ie.hidden=!0,ie.alreadyOpened=!0):D==="redirect"?(ie.show=!1,ie._refs=null,ie.alreadyOpened=!1):(ie.hidden=!0,ie.alreadyOpened=!0)),ke($e=>$e+1),Ee.lastSceneId=x}else ee.show||(ee.show=!0,G(ie=>[...ie,x]))};const xe={open({todo:x,frameId:q,parentScope:D,comProps:ae}){var se;const ee=Z[q];ee?executor({json:ee,getComDef:Pe=>k.getComDef(Pe),events:m.events,env:P,ref(Pe){var Me;const{inputs:ie,outputs:le}=Pe;ee.outputs.forEach(je=>{le(je.id,L=>{D.outputs[je.id](L)})});const $e=(Me=ae==null?void 0:ae.data)==null?void 0:Me.configs;$e&&Object.entries($e).forEach(([je,L])=>{ie[je](L,void 0,!1)}),ie[x.pinId](x.value,void 0,!1),Pe.run()},onError:k.onError,debug:m.debug,debugLogger:m.debugLogger,logger:k.logger,scenesOperate:xe,_context:k},{observable:k.observable}):(se=P.callServiceFx)==null||se.call(P,q,x.value).then(({id:Pe,value:ie})=>{D.outputs[Pe](ie)})},inputs({frameId:x,parentScope:q,value:D,pinId:ae}){const ee=z[x];if(!ee)v[x]?v[x].todo.push({frameId:x,parentScope:q,value:D,pinId:ae}):v[x]={parentScope:q,todo:[{value:D,pinId:ae}]};else{if(ee.alreadyOpened)return;ee.parentScope=q,ee._refs?ee._refs.inputs[ae](D):ee.todo=ee.todo.concat({type:"inputs",todo:{pinId:ae,value:D}})}},_notifyBindings(x,q){const{bindingsTo:D}=q.model;if(D)for(let ae in D)for(let ee in z){const se=z[ee];if(se.json.coms[ae])if(se._refs)me(se._refs,ae,D[ae],x);else{const ie=D[ae];se.todo=se.todo.concat({type:"globalVar",todo:{comId:ae,bindings:ie,value:x}})}}},getGlobalComProps(x){var D;return d?{data:{val:d.get(x)}}:x in I?{data:{val:I[x]}}:(D=z[j.scenes[0].id]._refs)==null?void 0:D.get({comId:x})},exeGlobalCom({com:x,value:q,pinId:D}){const ae=x.id;I[ae]=q,d==null||d.set(ae,q),Object.keys(z).forEach(ee=>{const se=z[ee];if(se.show&&se._refs){const Pe=se._refs.get({comId:ae});Pe&&Pe.outputs[D](q,!0,null,!0)}})},var:new Var};return P.scenesOperate=xe,{scenesMap:j.scenes.reduce((x,q,D)=>{var ae;return{...x,[q.id]:{show:D===0,todo:[],json:q,disableAutoRun:!!(W||D),useEntryAnimation:!1,type:((ae=q.slot)==null?void 0:ae.showType)||q.type,main:D===0}}},{}),scenesOperateInputsTodo:{},globalVarMap:{},globalFxIdToFrame:Z,env:P}},{scenesMap:z,scenesOperateInputsTodo:v,globalVarMap:I,env:R}=be(),{options:b}=a;if(b.ref){const j=b.ref;b.ref=m=>S=>(m(S),j.call(b,S))}else b.ref=j=>m=>{j(m)};const O=j=>{const m=z[j];return{...b,env:R,get disableAutoRun(){return m.disableAutoRun},ref:b.ref(S=>{var A;S.canvas=R.canvas,m._refs=S;const W=m.todo,{inputs:d,outputs:P}=S,V=m.disableAutoRun;(A=m.json.outputs)==null||A.forEach($=>{P($.id,y=>{var C,Q,Z;$.id==="apply"?(C=m.parentScope)==null||C.outputs[$.id](y):m.type!=="module"&&V?(m.show=!1,m.todo=[],m._refs=null,(Q=m.parentScope)==null||Q.outputs[$.id](y),m.parentScope=null,m.type==="popup"?G(Ce=>Ce.filter(Ee=>Ee!==m.json.id)):ke(Ce=>Ce+1)):(Z=m.parentScope)==null||Z.outputs[$.id](y)})}),W.length?(W.forEach(({type:$,todo:y})=>{if($==="inputs")Promise.resolve().then(()=>{d[y.pinId](y.value,j)});else if($==="globalVar"){const{comId:C,value:Q,bindings:Z}=y;me(S,C,Z,Q)}}),m.type||debugHistory.setTodo(W),m.todo=[]):V||(m.disableAutoRun=!0,Promise.resolve().then(()=>{var y,C;const $=[];(C=(y=m.json.inputs)==null?void 0:y.forEach)==null||C.call(y,Q=>{const{id:Z,mockData:Ce,type:Ee,extValues:xe}=Q;let x;if(b.debug)if(Ee==="config"&&(xe!=null&&xe.config)&&"defaultValue"in xe.config)try{x=JSON.parse(decodeURIComponent(xe.config.defaultValue))}catch{x=xe.config.defaultValue}else try{x=JSON.parse(decodeURIComponent(Ce))}catch{x=Ce}$.push({type:"inputs",todo:{pinId:Z,value:x}}),d[Z](x)}),m.type||debugHistory.setTodo($)}),S.run()),V&&Promise.resolve().then(()=>{S.run()})}),_env:{loadCSSLazy(){},currentScenes:{close(){m.show=!1,m.todo=[],m._refs=null,m.type==="popup"?G(S=>S.filter(W=>W!==m.json.id)):ke(S=>S+1)}}},scenesOperate:R.scenesOperate}},B=c(()=>{const{options:j}=a;return M.value.pageScenes.map(m=>{const{id:S}=m,W=z[S];if(W.show){let d=W.useEntryAnimation?"main":"",P={};if(W.main){const{className:V,style:A}=j;V&&(d=d+` ${V}`),A&&(P=Object.assign(P,A))}return W.hidden&&(P.display="none"),{json:{...m,scenesMap:z},options:O(S),className:d,style:P,from:"scene"}}return null})}),ne=c(()=>M.value.popupIds.map(j=>{const m=z[j],S=m.json,{id:W}=S;let d={position:b.debug?"fixed":"absolute",top:0,left:0,backgroundColor:"#ffffff00",zIndex:1e3};if(m.main){const{className:P,style:V}=b;V&&(d=Object.assign(d,V))}return{json:{...S,scenesMap:z},options:O(W),style:{position:b.debug?"fixed":"absolute",top:0,left:0,backgroundColor:"#ffffff00",zIndex:1e3}}}));return(j,m)=>(vue.openBlock(),vue.createElementBlock(vue.Fragment,null,[(vue.openBlock(!0),vue.createElementBlock(vue.Fragment,null,vue.renderList(vue.unref(B).filter(S=>S),S=>(vue.openBlock(),vue.createBlock(_sfc_main$1,{key:S.key,json:S.json,options:S.options,className:S.className,style:vue.normalizeStyle(S.style),from:S.from},null,8,["json","options","className","style","from"]))),128)),(vue.openBlock(!0),vue.createElementBlock(vue.Fragment,null,vue.renderList(vue.unref(ne).filter(S=>S),S=>(vue.openBlock(),vue.createBlock(_sfc_main$1,{key:S.key,json:S.json,options:S.options,style:vue.normalizeStyle(S.style)},null,8,["json","options","style"]))),128))],64))}}),MMultiScene=_export_sfc(_sfc_main,[["__scopeId","data-v-bb548d0b"]]),{h,reactive,provide}=window.Vue;class Context{constructor(e,l){Le(this,"performance",{render:{start:window.MYBRICKS_PC_FMP_START||new Date().getTime(),end:null,time:null},callConnectorTimes:[]});Le(this,"onCompleteCallBacks",[]);Le(this,"mode");Le(this,"_v");Le(this,"comDefs",{});Le(this,"onError",e=>{console.error(e)});Le(this,"logger");Le(this,"observable",reactive);this.options=e,this._v=l._v;const{env:o,debug:c,observable:a,onError:k,plugins:T=[],rootId:M}=e,{onCompleteCallBacks:g}=this;o.runtime||(o.runtime={onComplete(I){c&&g.push(I)}});const G=document.head;e.stylization=new Stylization({rootId:M,root:G,options:e,onCompleteCallBacks:g}),this.mode=c?"development":"production";let ke;const me=e==null?void 0:e.pxToVw;me?(ke=getPxToVw(me),e.handlePxToVw=ke,o.pxToVw=ke):o.pxToVw=I=>I;const be=o==null?void 0:o.pxToRem;if(be){const{enableAdaptive:I=!1,landscapeWidth:R=1440}=be,b=document.documentElement;if(I){const O=()=>{b.style.fontSize=b.clientWidth/(R/12)+"px"};O(),window.addEventListener("resize",O)}else b.style.fontSize="12px"}if(o.i18n||(o.i18n=I=>I),o.renderModule=(I,R)=>{const b=e.rootId,O=R.rootId;let B=b||O;return b&&O&&(B=b+"_"+O),render(I,{...e,...R,rootId:B,env:o,_isNestedRender:!0,_context:this})},!o.renderCom)o.renderCom=(I,R)=>render(I,{...e,...R,_isNestedRender:!0,_isNestCom:!0,_context:this});else{const I=o.renderCom;o.renderCom=(R,b)=>I(R,{...e,...b,_isNestedRender:!0,_isNestCom:!0,_context:this})}const z=document.body;o.canvas||(o.canvas={get type(){return z.clientWidth<=414?"mobile":"pc"}}),"canvasElement"in o||(o.canvasElement=z);const v=this;window.RENDER_WEB_PERFORMANCE={getPerformance:this.getPerformance.bind(v)},this.initOther(),this.initComdefs()}initOther(){this.options,this.logger={info:console.info,trace:console.trace,warn:console.warn,error:e=>{console.error(e)}}}initComdefs(){const e=(a,k)=>{a.forEach(T=>{T.comAray?e(T.comAray,k):k[`${T.namespace}-${T.version}`]=T})},{comDefs:l}=this.options,{comDefs:o}=this;l&&Object.assign(o,l);const c=[...window.__comlibs_edit_||[],...window.__comlibs_rt_||[]];c.push(coreLib),c.forEach(a=>{const k=a.comAray;k&&Array.isArray(k)&&e(k,o)})}getComDef(e){const{comDefs:l}=this,o=l[e.namespace+"-"+e.version]||l[e.namespace];if(!o){const c=[];for(const a in l)a.startsWith(e.namespace+"-")&&c.push(l[a]);if(c&&c.length>0){c.sort((k,T)=>compareVersion(k.version,T.version));const a=c[0];return console.warn(`【Mybricks】组件${e.namespace+"@"+e.version}未找到，使用${a.namespace}@${a.version}代替.`),a}else return console.error(`组件${e.namespace+"@"+e.version}未找到，请确定是否存在该组件以及对应的版本号.`),null}return o}getPerformance(){return this.performance}setPerformanceRender(e,l){const o=this.performance.render;o[e]=l,e==="end"&&(o.time=l-o.start)}setPerformanceCallConnectorTimes(e){this.performance.callConnectorTimes.push(e)}}class Stylization{constructor({rootId:e,root:l,options:o,onCompleteCallBacks:c}){Le(this,"options");Le(this,"root");Le(this,"rootId");Le(this,"_defaultStyleMap",{});Le(this,"_cssMap",{});this.root=l,this.rootId=e,this.options=o;const{_cssMap:a}=this,k=()=>{Object.entries(a).forEach(([T,M])=>{l.removeChild(M.tag)})};c.push(k)}hasDefaultStyle(e){return this._defaultStyleMap[e]}setDefaultStyle(e){this._defaultStyleMap[e]=!0}setStyle(e,l){let o=[];Array.isArray(l)?o=l:Object.entries(l).forEach(([k,T])=>{o.push({selector:k,css:T})});const c=e.split("-"),a=c[c.length-1];if(o.length){const{rootId:k,root:T,options:M}=this,{env:g,handlePxToVw:G,debug:ke}=M,{pxToRem:me}=g,be=ke?"#_geoview-wrapper_ ":"",z={};o.forEach(({css:I,selector:R,global:b})=>{R===":root"&&(R="> *:first-child"),(Array.isArray(R)?R:[R]).forEach(O=>{const B=`${be}${b?"":`#${a}[data-nested-id="${e}"] `}${O.replace(/\{id\}/g,`${a}`)}`,ne={};Object.entries(I).forEach(([j,m])=>{me&&typeof m=="string"&&m.indexOf("px")!==-1?m=pxToRem(m):G&&typeof m=="string"&&m.indexOf("px")!==-1&&(m=G(m)),ne[convertCamelToHyphen(j)]=m}),z[B]?z[B]=Object.assign(z[B],ne):z[B]=ne})});const v=this._cssMap[e];if(v){const{tag:I,css:R}=v,b=Array.from(I.sheet.cssRules).reduce((O,B)=>(O[B.selectorText]=B,O),{});Object.entries(z).forEach(([O,B])=>{var j;const ne=(j=b[O])==null?void 0:j.style;if(ne){const m=R[O];Object.entries(B).forEach(([S,W])=>{m[S]=W,ne[S]=W})}else R[O]=B,I.sheet.insertRule(`${O} {${Object.entries(B).map(([m,S])=>`${m}: ${S};`).join("")}}`)})}else{const I=document.createElement("style");this._cssMap[e]={tag:I,css:z},T.appendChild(I),Object.entries(z).forEach(([R,b])=>{I.sheet.insertRule(`${R} {${Object.entries(b).map(([O,B])=>`${O}: ${B};`).join("")}}`)})}}}}const render=(n,e)=>{if(e.sceneOpenType||(e.sceneOpenType="redirect"),n){let l=null,o={};if("scenes"in n?(l=MMultiScene,o={json:n,options:e}):n.slot&&(l=_sfc_main$1,o={json:n,options:e,root:n.type!=="module"}),!l){const c=e._isNestedRender?e._context:new Context(e,n);return executor({json:n,getComDef:a=>c.getComDef(a),events:e.events,env:e.env,ref(a){if(typeof e.ref=="function")e.ref(a);else{const{inputs:k}=a,T=n.inputs;k&&Array.isArray(T)&&T.forEach(M=>{const{id:g,mockData:G,type:ke,extValues:me}=M;let be;if(e.debug)if(ke==="config"&&(me!=null&&me.config)&&"defaultValue"in me.config)try{be=JSON.parse(decodeURIComponent(me.config.defaultValue))}catch{be=me.config.defaultValue}else try{be=JSON.parse(decodeURIComponent(G))}catch{be=G}k[g](be)}),a.run()}},onError:c.onError,debug:e.debug,debugLogger:e.debugLogger,logger:c.logger,scenesOperate:e.scenesOperate,_isNestedRender:e._isNestedRender,_isNestCom:e._isNestCom,_context:c},{observable:c.observable}),null}if(e._isNestCom){const c=deepCopy(e.env);o.ModuleContext={env:c}}return e._isNestedRender||(!("scenes"in n)&&n.type==="module"&&(e.env.edit=null),o.MyBricksRenderContext=new Context(e,n),o.ModuleContext={env:e.env}),h(l,o)}else return null},pkg={name:"@mybricks/render-web-vue3",version:"0.0.1"};console.log(`%c ${pkg.name} %c@${pkg.version}`,"color:#FFF;background:#fa6400","",""),exports.render=render,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
