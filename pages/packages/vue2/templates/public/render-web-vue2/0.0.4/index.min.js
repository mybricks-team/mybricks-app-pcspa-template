(function(n,e){typeof exports=="object"&&typeof module<"u"?e(exports,require("vue")):typeof define=="function"&&define.amd?define(["exports","vue"],e):(n=typeof globalThis<"u"?globalThis:n||self,e(n._mybricks_render_web_vue2={},n.Vue))})(this,function(exports,Vue){"use strict";var Ue=Object.defineProperty;var qe=(n,e,t)=>e in n?Ue(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var He=(n,e,t)=>(qe(n,typeof e!="symbol"?e+"":e,t),t);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var fn={exports:{}};(function(module,exports){(function(n,e){module.exports=e()})(commonjsGlobal,()=>(()=>{var __webpack_modules__={356:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{function __WEBPACK_DEFAULT_EXPORT__({data,outputs,inputs,onError}){inputs.from((val,relOutpus)=>{var _a;const script=(_a=data.exchange)===null||_a===void 0?void 0:_a.script;if(script){let fn,returnVal,isOk;try{eval(`fn = ${script}`),returnVal=fn(val),isOk=!0}catch(n){console.error(n),onError(`数据转换错误:${n.message}`,n)}isOk&&outputs.to(returnVal)}else onError("未配置转换规则")})}__webpack_require__.d(__webpack_exports__,{Z:()=>__WEBPACK_DEFAULT_EXPORT__})}},__webpack_module_cache__={};function __webpack_require__(n){var e=__webpack_module_cache__[n];if(e!==void 0)return e.exports;var t=__webpack_module_cache__[n]={exports:{}};return __webpack_modules__[n](t,t.exports,__webpack_require__),t.exports}__webpack_require__.d=(n,e)=>{for(var t in e)__webpack_require__.o(e,t)&&!__webpack_require__.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},__webpack_require__.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),__webpack_require__.r=n=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})};var __webpack_exports__={};return(()=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>j,getCom:()=>_});const n=JSON.parse('{"title":"Fn计算","namespace":"mybricks.core-comlib.fn","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"Fn计算","icon":"./icon.png","runtime":"./Fn.tsx","rtType":"js","visibility":false}'),e=JSON.parse('{"visibility":false,"title":"变量","namespace":"mybricks.core-comlib.var","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"变量","icon":"./icon.png","data":"./data.json","runtime":"./Var.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"get","title":"读取","schema":{"type":"any"},"rels":["return"]},{"id":"set","title":"赋值","schema":{"type":"follow"},"rels":["return"]},{"id":"reset","title":"重置","schema":{"type":"any"}}],"outputs":[{"id":"return","title":"完成","schema":{"type":"unknown"}},{"id":"changed","title":"当值发生变化","schema":{"type":"unknown"}}]}');function t(l){if(l&&typeof l=="object")try{return l instanceof FormData?l:JSON.parse(JSON.stringify(l))}catch{return l}return l}const o=JSON.parse('{"title":"类型转换","visibility":false,"namespace":"mybricks.core-comlib.type-change","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"类型转换","icon":"./icon.png","runtime":"./rt.tsx","editors":"./editors.tsx","rtType":"js","inputs":[{"id":"from","title":"从","schema":{"type":"follow"},"rels":["to"]}],"outputs":[{"id":"to","title":"到","schema":{"type":"follow"},"conMax":1,"editable":true}]}');var i=__webpack_require__(356);const p=JSON.parse('{"deprecated":true,"visibility":false,"title":"连接器","namespace":"mybricks.core-comlib.connector","author":"MyBricks","author_name":"MyBricks","version":"1.0.0","description":"连接器","runtime":"./runtime.ts","editors":"./editors.tsx","icon":"./icon.svg","rtType":"js-autorun","inputs":[{"id":"call","rels":["then","catch"],"title":"调用","schema":{"type":"object"}}],"outputs":[{"id":"then","title":"结果","schema":{"type":"unknown"}},{"id":"catch","title":"发生错误","schema":{"type":"string"}}]}');function a({env:l,data:h,outputs:b,onError:I},d={}){if(h.connector)try{l.callConnector(h.connector,d,h.connectorConfig).then(C=>{b.then(C)}).catch(C=>{b.catch(C)})}catch(C){console.error(C),b.catch(`执行错误 ${C.message||C}`)}else b.catch("没有选择接口")}const y=JSON.parse('{"visibility":false,"title":"作用域输入","namespace":"mybricks.core-comlib.frame-input","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"作用域输入","rtType":"js","runtime":"./runtime.ts","editors":"./editor.tsx","inputs":[{"id":"getCurValue","title":"获取","schema":{"type":"any"},"rels":["return"]}],"outputs":[{"id":"return","title":"结果","schema":{"type":"follow"}}]}'),g=JSON.parse('{"visibility":false,"title":"打开对话框","namespace":"mybricks.core-comlib.scenes","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"切换场景","icon":"./icon.png","runtime":"./runtime.ts","data":"./data.json","rtType":"js","inputs":[{"id":"open","title":"打开","schema":{"type":"any"}}]}'),u=JSON.parse('{"title":"模块","namespace":"mybricks.core-comlib.module","author":"CheMingjun","author_name":"车明君","version":"1.0.0","description":"模块","icon":"./icon.png","data":"./data.json","runtime":"./runtime.tsx","editors":"./editors.ts"}'),f={id:"mybricks-core-comlib",title:"Mybrics核心组件库",author:"CheMingjun",icon:"",version:"1.0.1",comAray:[w({comDef:n,rt:function({inputs:l,outputs:h}){}}),w({comDef:e,rt:function({env:l,data:h,outputs:b,inputs:I,_notifyBindings:d}){I.get((C,k)=>{const E=t(h.val!==void 0?h.val:h.initValue);k.return(E)}),I.set((C,k)=>{h.val=C;const E=t(C);b.changed(E,!0),d(E),k.return(E)}),I.reset(()=>{const C=h.initValue;h.val=C;const k=t(C);b.changed(k,!0),d(k)})}}),w({comDef:o,rt:i.Z}),w({comDef:p,rt:function({env:l,data:h,inputs:b,outputs:I,onError:d}){l.runtime&&(h.immediate?a({env:l,data:h,outputs:I}):b.call(C=>{a({env:l,data:h,outputs:I,onError:d},C)}))}}),w({comDef:y,rt:function({env:l,data:h,inputs:b,outputs:I}){l.runtime&&b.getCurValue((d,C)=>{C.return(d)})}}),w({comDef:g,rt:function({env:l,data:h,inputs:b,_inputs:I,_inputsCallable:d}){b.open(C=>{l.canvas.open(h._sceneId,C,h._sceneShowType==="popup"?null:h.openType),d._open(C)})}}),w({comDef:u,rt:function({env:l,data:h,inputs:b,outputs:I}){const d=l.getModuleJSON(h.definedId);return l.renderModule(d,{ref(C){const{inputs:k,outputs:E}=d;k.forEach(({id:N})=>{b[N](H=>{C.inputs[N](H)})}),E.forEach(({id:N})=>{C.outputs(N,I[N])});const K=h.configs;for(let N in K)C.inputs[N](K[N]);C.run()},disableAutoRun:!0})}})]},j=f;function _(l){return f.comAray.find(h=>h.namespace===l)}function w({comDef:l,rt:h,data:b}){return Object.assign(l,{runtime:h,data:b})}})(),__webpack_exports__})())})(fn);var fnExports=fn.exports;const coreLib=getDefaultExportFromCjs(fnExports);function logInputVal(n,e,t,o){let i;try{i=JSON.stringify(o)}catch{i=o}console.log(`%c [MyBricks] 输入项 %c ${n||e.title||e.namespace} | ${t} -> ${i}`,"color:#FFF;background:#000","","")}function logOutputVal(n,e,t,o){let i;try{i=JSON.stringify(o)}catch{i=o}console.log(`%c [MyBricks] 输出项 %c ${n||e.title||e.namespace} | ${t} -> ${i}`,"color:#FFF;background:#fa6400","","")}function isNumber(n){return typeof n=="number"&&!isNaN(n)}function uuid$1(n=5,e=8){const t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),o=[];if(e=e||t.length,n)for(let i=0;i<n;i++)o[i]=t[0|Math.random()*e];else{let i;o[8]=o[13]=o[18]=o[23]="-",o[14]="4";for(let p=0;p<36;p++)o[p]||(i=0|Math.random()*16,o[p]=t[p==19?i&3|8:i])}return o.join("")}function convertCamelToHyphen(n){return n.replace(/([A-Z])/g,"-$1").toLowerCase()}const toFixed=function n(e,t){var o=Math.pow(10,t+1),i=Math.floor(e*o);return Math.round(i/10)*10/o},createPxReplacer=function n(e,t,o,i){return function(p,a){var y=parseFloat(a);return!a||y<=t?p:"".concat(toFixed(y/e,o)).concat(i)}},remReplace=createPxReplacer(12,0,5,"rem"),vwReplace=createPxReplacer(3.75,0,5,"vw"),REG_PX=/"[^"]+"|'[^']+'|url\([^)]+\)|(\d*\.?\d+)px/g,pxToRem=n=>n.replace(REG_PX,remReplace),pxToVw=n=>n.replace(REG_PX,vwReplace);function dataSlim(n){return n}const ROOT_FRAME_KEY="_rootFrame_";function executor(n,{observable:e}){const{json:t,getComDef:o,env:i,ref:p,onError:a,logger:y,debug:g,debugLogger:u,_isNestedRender:f,_context:j}=n,_=n.scenesOperate||i.scenesOperate,{slot:w,coms:l={},comsAutoRun:h={},cons:b=[],pinRels:I={},pinProxies:d={},pinValueProxies:C={},type:k}=t,E=i,K={},N={},H={},U={},_e={};Object.keys(b).forEach(r=>{const c=b[r],{startPinParentKey:s}=c[0];s&&(_e[s]=r)});const ge={},fe={},be={},we={},Ie={},q={};function de(r,c,s){if(!f){if(r==="com"){const{com:v,pinHostId:x,val:S,fromCon:O,notifyAll:$,comDef:m,conId:T}=c;u?u("com","output",{id:v.id,pinHostId:x,val:S,fromCon:O,notifyAll:$,comDef:m,sceneId:t.id,conId:T},s):logOutputVal(v.title,m,x,S)}else if(r==="frame"){const{comId:v,frameId:x,pinHostId:S,val:O,sceneId:$,conId:m}=c;u&&u("frame","output",{comId:v,frameId:x,pinHostId:S,val:O,sceneId:$||t.id,conId:m},s)}}}function ye(r,c){if(f)return;const{com:s,pinHostId:v,val:x,frameKey:S,finishPinParentKey:O,comDef:$,conId:m}=r;m&&(u?u("com","input",{id:s.id,pinHostId:v,val:x,frameKey:S,finishPinParentKey:O,comDef:$,sceneId:t.id,conId:m},c):logInputVal(s.title,$,v,x))}function Y(r,c,s,v){var S,O;const x=d[r.comId+"-"+r.pinId];if(x){if(be[`${x.frameId}-${x.pinId}`]=s,v&&v.finishPinParentKey!==r.startPinParentKey)return;if(x.type==="frame"){const $=ae(r.comId,c);let m;m={id:uuid$1(10,16),frameId:x.frameId,parent:c,proxyComProps:$};const T=r.def.namespace==="mybricks.core-comlib.frame-output";if(T&&c&&(x.frameId=c.proxyComProps.id,m=c.parent),r.def.namespace==="mybricks.core-comlib.fn"){const{configs:se}=$.data;se&&Object.entries(se).forEach(([V,M])=>{const{frameId:A,comId:R,pinId:G}=x,F=R?`${R}-${A}`:`${A}`,P=b[F+"-"+V];P&&X({logProps:null,cons:P,val:M,curScope:m})})}Be({options:x,value:s,scope:m,comProps:$}),T||Ae({frameId:x.frameId,scope:m});return}}if(r.type==="com")v?v.finishPinParentKey===r.startPinParentKey&&ce(r,s,c):ce(r,s,c);else if(r.type==="frame"){if(v&&v.finishPinParentKey!==r.startPinParentKey)return;if(r.comId){if(r.direction==="inner-input"){const $=N[r.frameKey+"-"+r.pinId]||N[r.comId+"-"+r.frameId+"-"+((S=c==null?void 0:c.parent)!=null&&S.id?c.parent.id+"-":"")+r.pinId];$&&$(s)}else if(r.direction==="inner-output"&&r.pinType==="joint"){const $=b[r.comId+"-"+r.frameId+"-"+r.pinId];$&&X({logProps:null,cons:$,val:s})}}else{const $=c==null?void 0:c.proxyComProps;if($){const m=$.outputs[r.pinId];if(m){m(s,c.parent);return}}(O=U[r.pinId])==null||O.call(U,s)}}else throw new Error("尚未实现")}function X({logProps:r,cons:c,val:s,curScope:v,fromCon:x,notifyAll:S,fromCom:O,isAutoRun:$}){g&&k!=="module"&&c.sort((m,T)=>m.isBreakpoint&&!T.isBreakpoint?-1:!m.isBreakpoint&&T.isBreakpoint?1:0),c.forEach(async m=>{var R,G;const{comId:T,pinId:J,pinType:se,timerPinInputId:V,frameKey:M}=m,A=l[T];if(!(x&&x.finishPinParentKey!==m.startPinParentKey)&&!(g&&m.isIgnored)){if(g&&k!=="module"&&((R=j.debuggerPanel)!=null&&R.hasBreakpoint(m))){let F=!0;await((G=j.debuggerPanel)==null?void 0:G.wait(m,()=>{F=!1,r&&(r[1].conId=m.id,r&&de(...r,!0))})),F&&r&&(r[1].conId=m.id,r&&de(...r))}else r&&de(...r);if(se==="timer")ne({value:s,curScope:v,inReg:m,notifyAll:S,fromCon:x});else if(S){const F=m.frameKey;if(F===ROOT_FRAME_KEY||$)oe({pinId:J,value:s,component:A,curScope:null,comId:T,val:s,timerPinInputId:V,frameKey:F,inReg:m,notifyAll:S,fromCon:x});else{const[P,B]=F.split("-");if(we[F]){const z=we[F],ee=z[O.id];ee?ee[m.id]=m:z[O.id]={[m.id]:m}}else{const z=we[F]={};z[O.id]={[m.id]:m}}if(O.parentComId)oe({pinId:J,value:s,component:A,curScope:v,comId:P,val:s,timerPinInputId:V,frameKey:F,inReg:m,notifyAll:S,fromCon:x});else{const z=K[`${P}-${B}`];z&&Object.entries(z).forEach(([ee,Z])=>{(Z==null?void 0:Z.type)==="scope"?Z.curScope?oe({pinId:J,value:s,component:A,curScope:Z.curScope,comId:P,val:s,timerPinInputId:V,frameKey:F,inReg:m,notifyAll:S,fromCon:x}):Z.pushTodo(le=>{oe({pinId:J,value:s,component:A,curScope:le,comId:P,val:s,timerPinInputId:V,frameKey:F,inReg:m,notifyAll:S,fromCon:x})}):oe({pinId:J,value:s,component:A,curScope:Z.curScope,comId:P,val:s,timerPinInputId:V,frameKey:F,inReg:m,notifyAll:S,fromCon:x})})}}}else oe({pinId:J,value:s,component:A,curScope:v,comId:T,val:s,timerPinInputId:V,frameKey:M,inReg:m,notifyAll:S,fromCon:x})}})}function ne({pinId:r,value:c,curScope:s,inReg:v,notifyAll:x,fromCon:S}){let O=s;const $=r?{...v,pinId:r}:v;if(x){const m=$.frameKey;if(!m)throw new Error("数据异常，请检查toJSON结果.");m===ROOT_FRAME_KEY?Y($,{},c,S):Y($,s,c,S)}else{const m=$.frameKey.split("-");if(m.length>=2&&!O){const T=Ke(m[0],m[1],null,!1);(T==null?void 0:T.type)==="scope"?T.curScope?Y($,T.curScope,c,S):T.pushTodo(J=>{Y($,J,c,S)}):Y($,O,c,S)}else Y($,O,c,S)}}function oe({pinId:r,value:c,component:s,curScope:v,comId:x,val:S,timerPinInputId:O,frameKey:$,inReg:m,notifyAll:T,fromCon:J}){const{isReady:se,isMultipleInput:V,pinId:M,value:A,cb:R}=xe({pinId:r,value:c,component:s,curScope:v,comId:x,val:S});if(se){const G={pinId:V?M:null,value:A,curScope:v,inReg:m,notifyAll:T,fromCon:J};if(O){const F=O+"-"+$+(v!=null&&v.id?`-${v.id}`:""),P=fe[F];if(P){const{ready:B,todo:z}=P;if(B){let ee=!1;Object.entries(z).forEach(([Z,le])=>{Z===M?(ne(G),ee=!0):le()}),ee||ne(G),R==null||R(),Reflect.deleteProperty(fe,F)}else z[M]=()=>{R==null||R(),ne(G)}}else fe[F]={ready:!1,todo:{[M]:()=>{R==null||R(),ne(G)}}}}else R==null||R(),ne(G)}}function xe({pinId:r,value:c,component:s,curScope:v,comId:x,val:S}){const O=r.indexOf("."),$={pinId:r,value:c,isReady:!0,isMultipleInput:!1,cb:null};if(s&&O!==-1){const m=x+`${v!=null&&v.id?`-${v.id}`:""}`,{inputs:T}=s,J=r.substring(0,O);$.pinId=J;const se=r.substring(O+1);let V=ge[m];V||(V=ge[m]={}),V[se]=S;const M=new RegExp(`${J}.`),A=T.filter(R=>!!R.match(M));Object.keys(V).length===A.length?($.value=V,$.isMultipleInput=!0,$.cb=()=>{Reflect.deleteProperty(ge,m)}):$.isReady=!1}return $}function ae(r,c){var Ne,Pe,Le;const s=l[r];if(!s)return null;const v=r+(s.frameId||ROOT_FRAME_KEY);let x=K[v];x||(x=K[v]={});let S,O=c;for(!O&&s.parentComId&&s.frameId&&(O=(Pe=(Ne=K[`${s.parentComId}-${s.frameId}`])==null?void 0:Ne.slot)==null?void 0:Pe.curScope);O;){const W=O.id+"-"+r;if(O.frameId===s.frameId){S=O.id;const D=x[W];if(D)return D;{const L=O.parentComId;if(L){if(L===s.paramId||L===s.parentComId)break}else break}}O=O.parent}const $=(S?S+"-":"")+r,m=x[$];if(m)return m;const T=s.def,J=s.model,se=JSON.parse(JSON.stringify(J.data)),V=JSON.parse(JSON.stringify(J.style));V.__model_style__=!0;const M={},A={},R={},G=(W,D,L,te)=>{let Q=A[W];Q||(A[W]=Q=[]),Q.push({val:D,fromCon:L,fromScope:te})},F=function(W){return new Proxy({},{ownKeys(D){return s.inputs},getOwnPropertyDescriptor(D){return{enumerable:!0,configurable:!0}},get(D,L){return function(te){if(Object.prototype.toString.call(L)==="[object Symbol]")return;const Q=W==null?void 0:W.inputs;if(Q){const ie=Q[L];typeof ie=="function"&&ie(te)}M[L]=te;const re=A[L];re&&(re.forEach(({val:ie,fromCon:pe,fromScope:je})=>{te(ie,new Proxy({},{get(he,Ee){return function(ke){if(Object.prototype.toString.call(Ee)==="[object Symbol]")return;const $e=z()[Ee];if(typeof $e=="function")$e(ke,je||O,pe);else throw new Error(`outputs.${Ee} not found`)}}}))}),A[L]=void 0)}}})},P=new Proxy({},{get(W,D){return function(L){if(Object.prototype.toString.call(D)==="[object Symbol]")return;const te=I[r+"-"+D];if(te){const Q={},re={};return te.forEach(ie=>{Q[ie]=pe=>{re[ie]=pe}}),Promise.resolve().then(()=>{ce({comId:r,def:T,pinId:D},L,c,re)}),Q}else ce({comId:r,def:T,pinId:D},L,c)}}}),B=new Proxy({},{get(W,D){return function(L){if(Object.prototype.toString.call(D)==="[object Symbol]")return;const te=d[r+"-"+D];te&&(_==null||_.inputs({...te,value:L,parentScope:ve}))}}}),z=function(W){return new Proxy({},{ownKeys(D){return s.outputs},getOwnPropertyDescriptor(D){return{enumerable:!0,configurable:!0}},get(D,L,te){const Q=function(re,ie,pe,je){if(Object.prototype.toString.call(L)==="[object Symbol]")return;const he=typeof ie=="boolean"&&ie;if(he){if(s.parentComId){const me=`${s.parentComId}-${s.frameId}`;q[me]?q[me][r]=!0:q[me]={[r]:!0}}if(Ie[`${s.id}${c!=null&&c.id?`-${c.id}`:""}`]=re,s.global&&!je){_==null||_.exeGlobalCom({com:s,value:re,pinId:L});return}}const Ee=arguments,ke=W==null?void 0:W.outputs;if(ke){const me=ke[L];typeof me=="function"&&me(re)}let $e;ie&&typeof ie=="object"&&($e=ie);const Te=o(T);if(!Te)return;const Je=J.outputEvents;let ue;if(Je){const me=Je[L];if(me&&Array.isArray(me)){const Ve=me.find(Re=>Re.active);if(Ve){const{type:Re}=Ve;switch(Re){case"none":ue=[];break;case"fx":const Fe=d[r+"-"+L];if((Fe==null?void 0:Fe.type)==="frame"){const Ce=`${Fe.frameId}-${Fe.pinId}`;ue=b[Ce]||[],be[Ce]=re}else ue=[];break;case"defined":break;default:if(ue=[],Array.isArray(i==null?void 0:i.events)){const Ce=i.events.find(ze=>{if(ze.type===Re)return ze});Ce&&typeof Ce.exe=="function"&&Ce.exe({options:Ve.options})}break}}}}ue=ue||b[r+"-"+L],ue!=null&&ue.length?Ee.length>=3&&typeof je>"u"?X({logProps:["com",{com:s,pinHostId:L,val:re,fromCon:pe,notifyAll:he,comDef:Te}],cons:ue,val:re,curScope:$e,fromCon:pe,fromCom:s}):X({logProps:["com",{com:s,pinHostId:L,val:re,fromCon:pe,notifyAll:he,comDef:Te}],cons:ue,val:re,curScope:$e||c,fromCon:pe,notifyAll:he,fromCom:s}):de("com",{com:s,pinHostId:L,val:re,fromCon:pe,notifyAll:he,comDef:Te})};return Q.getConnections=()=>b[r+"-"+L]||[],Q}})},ee=new Proxy({},{get(W,D,L){return function(te){if(Object.prototype.toString.call(D)==="[object Symbol]")return;const Q=R[D];Q&&(Q.forEach(re=>{te(re)}),R[D]=void 0)}}}),Z=new Proxy({},{get(W,D,L){return function(te){if(Object.prototype.toString.call(D)==="[object Symbol]")return;const Q=b[r+"-"+D];Q?X({logProps:["com",{com:s,pinHostId:D,val:te,comDef:T}],cons:Q,val:te,curScope:c}):de("com",{com:s,pinHostId:D,val:te,comDef:T})}}});function le(W){if(s.global){_==null||_._notifyBindings(W,s);return}const{bindingsTo:D}=s.model;if(D)for(let L in D){const te=ae(L);if(te){const Q=D[L];Array.isArray(Q)&&Q.forEach(re=>{let ie=te;const pe=re.split(".");pe.forEach((je,he)=>{he!==pe.length-1?ie=ie[je]:ie[je]=W})})}}}const Se=(Le=T.rtType)==null?void 0:Le.match(/^js/gi),ve={id:s.id,title:s.title,frameId:s.frameId,parentComId:s.parentComId,data:Se?se:e(se),style:Se?V:e(V),_inputRegs:M,addInputTodo:G,inputs:F(),inputsCallable:P,_inputsCallable:B,outputs:z(),_inputs:ee,_outputs:Z,clone(W){const D={inputs:F(W),outputs:z(W)};return Object.setPrototypeOf(D,this),D},_notifyBindings:le,logger:y,onError:g?W=>a({comId:r,error:W}):a};return x[$]=ve,ve}function Oe(r,c){let s=be[`${r}${c?`-${c.id}-${c.frameId}`:""}`];return typeof s>"u"&&(c!=null&&c.parent)&&(s=Oe(r,c.parent)),s}function ce(r,c,s,v){var V;const{comId:x,def:S,pinId:O,pinType:$,frameKey:m,finishPinParentKey:T,timerPinInputId:J,targetFrameKey:se}=r;if($==="ext"){const M=K[x]||ae(x,s);if(O==="show")M.style.display="";else if(O==="hide")M.style.display="none";else if(O==="showOrHide"){const R=M.style;typeof c>"u"?R.display==="none"?R.display="":R.display="none":R.display=c?"":"none"}const A=o(S);if(!A)return;ye({com:M,val:c,pinHostId:O,frameKey:m,finishPinParentKey:T,comDef:A,conId:r.id})}else if($==="config"){const M=ae(x,s),A=o(S);if(!A)return;ye({com:M,pinHostId:O,val:c,frameKey:m,finishPinParentKey:T,comDef:A,conId:r.id});const{extBinding:R}=r,G=R.split(".");let F=M;G.forEach((P,B)=>{B!==G.length-1?F=F[P]:F[P]=c})}else if($==="timer"){const M=ae(x,s),A=o(S);if(!A)return;ye({com:M,pinHostId:O,val:c,frameKey:m,finishPinParentKey:T,comDef:A,conId:r.id});const R=J+"-"+m+(s!=null&&s.id?`-${s.id}`:""),G=fe[R];if(G){const{todo:F}=G;Object.entries(F).forEach(([P,B])=>B()),Reflect.deleteProperty(fe,R)}else fe[R]={ready:!0,todo:{}}}else if((V=S.rtType)!=null&&V.match(/^js/gi)){const M=l[x];if(M){const A=ae(x,s),R=o(S);if(!R)return;if(M.global){const B=_==null?void 0:_.getGlobalComProps(x);B&&(A.data=B.data)}const G=s==null?void 0:s.id,F=(G?G+"-":"")+x;M.inputs.find(B=>B===O)?ye({com:M,val:c,pinHostId:O,frameKey:m,finishPinParentKey:T,comDef:R,conId:r.id}):Object.entries(c).forEach(([B,z])=>{ye({com:M,val:z,pinHostId:`${O}.${B}`,frameKey:m,finishPinParentKey:T,comDef:R,conId:r.id})}),H[F]||(H[F]=!0,R.runtime({env:E,data:A.data,inputs:A.inputs,outputs:A.outputs,_notifyBindings:A._notifyBindings,_inputsCallable:A._inputsCallable,logger:y,onError:g?B=>a({comId:x,error:B}):a}));const P=A._inputRegs[O];typeof P=="function"&&P(c,new Proxy({},{get(B,z){return function(ee){if(Object.prototype.toString.call(z)!=="[object Symbol]"){if(C){const Z=C[`${x}-${O}`];if(Z){const Se=`${Z.frameId===t.id?ROOT_FRAME_KEY:se||m}-${Z.pinId}`;ee=Oe(Se,s),typeof ee>"u"&&(ee=Oe(Se,null))}}A.outputs[z](ee,s,r)}}}}))}}else{const M=ae(x,s);if(!M)return;const A=o(S);if(!A)return;ye({com:M,pinHostId:O,val:c,frameKey:m,finishPinParentKey:T,comDef:A,conId:r.id});const R=M._inputRegs[O];if(typeof R=="function"){let G;v?G=v:G=new Proxy({},{get(F,P){return function(B){Object.prototype.toString.call(P)!=="[object Symbol]"&&M.outputs[P](B,s,r)}}}),R(c,G)}else M.addInputTodo(O,c,r,s)}if(T){const M=b[_e[T]];M&&!I[`${x}-${O}`]&&X({logProps:null,cons:M,val:void 0})}}function De(r,c){let s;return r!=null&&r.comAry&&r.comAry.find(v=>{if(v.id===c)return s=v,v;if(v.slots){for(let x in v.slots)if(s=De(v.slots[x],c),s)return s}}),s}function Ke(r,c,s,v){const x=`${r}-${c}`;let S=K[x];S||(S=K[x]={});let O=s?s.id:"slot",$=S[O];if(v&&!$&&console.log("不应该再走到这儿了: ",{comId:r,slotId:c,scope:s,notifyAll:v}),!$){const m=De(w,r);if(!(m!=null&&m.slots))return null;const T=m==null?void 0:m.slots[c],J={};let se;if(s){const F=K[r+"-"+c];F&&(se=F.todo)}const V={scope:s,todo:se},M=new Proxy({},{get(F,P){return function(B){Object.prototype.toString.call(P)!=="[object Symbol]"&&(J[P]=B)}}}),A=new Proxy({},{get(F,P){const B=function(z,ee){if(Object.prototype.toString.call(P)==="[object Symbol]")return;const Z=r+"-"+c+"-"+P,le=b[Z];be[`${Z}${ee?`-${ee.id}-${ee.frameId}`:""}`]=z,le?X({logProps:["frame",{comId:r,frameId:c,pinHostId:P,val:z}],cons:le,val:z,curScope:ee||V.scope}):de("frame",{comId:r,frameId:c,pinHostId:P,val:z})};return B.getConnections=()=>b[r+"-"+c+"-"+P]||[],B}}),R=new Proxy({},{get(F,P,B){return function(z){Object.prototype.toString.call(P)!=="[object Symbol]"&&(N[O+"-"+P]=z,N[x+"-"+P]=z)}}});let G={};$=S[O]={type:T==null?void 0:T.type,run(F){let P=V.scope;F&&P!==F&&(V.scope=F,P=F);const B=(P==null?void 0:P.id)||"none";if(G[B]||(G[B]=!0,Ae({comId:r,frameId:c,scope:P})),Array.isArray(V.todo)&&(V.todo.forEach(z=>{Promise.resolve().then(()=>{z(P)})}),V.todo=void 0),P&&O!=="slot"){const z=`${r}-${c}`,ee=we[z];Promise.resolve().then(()=>{ee&&Object.entries(ee).forEach(([Z,le])=>{if(!l[Z].parentComId){const ve=Object.entries(le).map(([Ne,Pe])=>Pe);ve.length&&X({logProps:null,cons:ve,val:Ie[Z],curScope:P,notifyAll:!0,fromCom:l[Z],isAutoRun:!0})}})})}},destroy(){if(s){const F=`${s.parentComId}-${s.frameId}`,P=q[F];P&&Object.keys(P).forEach(B=>{Reflect.deleteProperty(Ie,`${B}-${s.id}`)})}Reflect.deleteProperty(S,O)},_inputs:M,_inputRegs:J,inputs:A,outputs:R,get curScope(){return V.scope},setCurScope(F){V.scope=F},get todo(){return V.todo},pushTodo(F){V.todo||(V.todo=[]),V.todo.push(F)}}}return $}function Ae(r){const{comId:c,frameId:s,scope:v}=r,x=c?`${c}-${s}`:`${s}`,S=h[x];S&&S.forEach(O=>{const{id:$,def:m}=O;if(l[$]){const J=ae($,v),se=o(m);if(!se)return;se.runtime({env:E,data:J.data,inputs:J.inputs,outputs:J.outputs,_inputsCallable:J._inputsCallable,logger:y,onError:g?V=>a({comId:$,error:V}):a})}})}function Be({options:r,value:c,scope:s=void 0,log:v=!0,comProps:x}){const{frameId:S,comId:O,pinId:$,sceneId:m}=r,T=O?`${O}-${S}`:`${S}`,J=b[T+"-"+$];be[`${S}-${$}`]=c,J?X({logProps:["frame",{comId:O,frameId:S,pinHostId:$,val:c,sceneId:m}],cons:J,val:c,curScope:s}):(v&&de("frame",{comId:O,frameId:S,pinHostId:$,val:c,sceneId:m}),S!==ROOT_FRAME_KEY&&(t.id===S?U[$](c):_==null||_.open({frameId:S,todo:{pinId:$,value:c},comProps:x,parentScope:s.proxyComProps})))}const Me={get({comId:r,slotId:c,scope:s,_ioProxy:v}){let x;if(v&&(v.inputs||v.outputs||v._inputs||v._outputs)&&(x=v),c)return Ke(r,c,s);{const S=ae(r,s);return x?S.clone(x):S}},getComInfo(r){return l[r]}};if(typeof p=="function"){const r={run(){Ae({frameId:ROOT_FRAME_KEY})},inputs:new Proxy({},{get(c,s){return function(v,x=void 0,S=!0){Object.prototype.toString.call(s)!=="[object Symbol]"&&Be({options:{frameId:ROOT_FRAME_KEY,pinId:s,sceneId:x},value:v,scope:void 0,log:S})}}}),outputs(c,s){U[c]=s},get:Me.get,getComInfo:Me.getComInfo};p(r)}return Me}function normalizeComponent(n,e,t,o,i,p,a,y){var g=typeof n=="function"?n.options:n;e&&(g.render=e,g.staticRenderFns=t,g._compiled=!0),o&&(g.functional=!0),p&&(g._scopeId="data-v-"+p);var u;if(a?(u=function(_){_=_||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,!_&&typeof __VUE_SSR_CONTEXT__<"u"&&(_=__VUE_SSR_CONTEXT__),i&&i.call(this,_),_&&_._registeredComponents&&_._registeredComponents.add(a)},g._ssrRegister=u):i&&(u=y?function(){i.call(this,(g.functional?this.parent:this).$root.$options.shadowRoot)}:i),u)if(g.functional){g._injectStyles=u;var f=g.render;g.render=function(w,l){return u.call(l),f(w,l)}}else{var j=g.beforeCreate;g.beforeCreate=j?[].concat(j,u):[u]}return{exports:n,options:g}}const _sfc_main$7={props:{slotId:{type:String},propsSlot:{type:Object},params:{type:Object},props:{type:Object},propsStyle:{type:Object},onError:{type:Function},logger:{type:Object},env:{type:Object},_env:{type:Object},scope:{type:Object},getComDef:{type:Function},context:{type:Object}},created(){let n;const{propsSlot:e,scope:t,props:o,env:i,_env:p,getComDef:a,registSpm:y,context:g,onError:u,logger:f,params:j}=this.$props;if(Object.assign(j,j.m),(e==null?void 0:e.type)==="scope"?(n={id:uuid(10,16),frameId:slotId},t&&(n.parent=t)):n=t,j){const _=j.inputValues;if(typeof _=="object")for(let w in _)o.inputs[w](_[w],n);typeof j.wrap=="function"&&j.wrap}o.run(n),this.slotProps={scope:n,env:i,_env:p,propsSlot:e,params:j,getComDef:a,registSpm:y,context:g,inputs:j==null?void 0:j.inputs,outputs:j==null?void 0:j.outputs,_inputs:j==null?void 0:j._inputs,_outputs:j==null?void 0:j._outputs,onError:u,logger:f},this.slotComponent=RenderSlot}};var _sfc_render$7=function n(){var e=this,t=e._self._c;return t(e.slotComponent,e._b({tag:"component"},"component",e.slotProps,!1))},_sfc_staticRenderFns$7=[],__component__$7=normalizeComponent(_sfc_main$7,_sfc_render$7,_sfc_staticRenderFns$7,!1,null,null,null,null);const SlotRender=__component__$7.exports,_sfc_main$6={functional:!0,props:{env:Object,data:Object,inputs:Object,outputs:Object},render(n,{props:e}){const t=e.env.getModuleJSON(e.data.definedId);return n(Render,{props:e.env.renderModule(t,{ref:o=>{const{inputs:i,outputs:p}=t;i.forEach(({id:y})=>{e.inputs[y](g=>{o.inputs[y](g)})}),p.forEach(({id:y})=>{o.outputs(y,e.outputs[y])});const a=e.data.configs;for(let y in a)o.inputs[y](a[y]);o.run()},disableAutoRun:!0})})}},_sfc_render$6=null,_sfc_staticRenderFns$6=null;var __component__$6=normalizeComponent(_sfc_main$6,_sfc_render$6,_sfc_staticRenderFns$6,!1,null,null,null,null);const Module=__component__$6.exports,com="_com_z9da4_2",flex="_flex_z9da4_7",style0$2={com,flex},_sfc_main$5={props:{com:{type:Object},getComDef:{type:Function},registSpm:{type:Function},context:{type:Object},scope:{type:Object},props:{type:Object},env:{type:Object},_env:{type:Object},onError:{type:Function},logger:{type:Object}},components:{SlotRender},created(){var ye;const{_env:n,env:e,com:t,props:o,getComDef:i,registSpm:p,onError:a,logger:y,context:g,scope:u}=this.$props,{pxToRem:f,pxToVw:j}=e,{id:_,def:w,name:l,slots:h={}}=t,{data:b,title:I,style:d,inputs:C,outputs:k,_inputs:E,_outputs:K,_notifyBindings:N}=o,H=this.getStyleAry({env:e,def:w,style:d});if(Array.isArray(H)){const Y=(e==null?void 0:e.shadowRoot)||((ye=document.getElementById("_mybricks-geo-webview_"))==null?void 0:ye.shadowRoot);if(!(Y||document).querySelector(`style[id="${_}"]`)){const X=document.createElement("style");let ne="";X.id=_,H.forEach(({css:oe,selector:xe,global:ae})=>{xe===":root"&&(xe="> *:first-child"),ne=ne+`
            ${ae?"":`#${_} `}${xe.replace(/\{id\}/g,`${_}`)} {
              ${Object.keys(oe).map(Oe=>{let ce=oe[Oe];return f&&typeof ce=="string"&&ce.indexOf("px")!==-1?ce=pxToRem(ce):j&&typeof ce=="string"&&ce.indexOf("px")!==-1&&(ce=pxToVw(ce)),`${convertCamelToHyphen(Oe)}: ${ce};`}).join(`
`)}
            }
          `}),X.innerHTML=ne,Y?Y.appendChild(X):document.head.appendChild(X)}}Reflect.deleteProperty(d,"styleAry"),Reflect.deleteProperty(d,"themesId");const U=i(w),_e=[],ge={};t.slots&&Object.entries(t.slots).forEach(([Y,X])=>{const ne=g.get({comId:_,slotId:Y,scope:u});ge[Y]={get size(){var oe;return((oe=X==null?void 0:X.comAry)==null?void 0:oe.length)||0}},_e.push({slotId:Y,propsSlot:X,props:ne,propsStyle:d,onError:a,logger:y,env:e,_env:n,scope:u,getComDef:i,context:g})}),this.templateSlots=_e;let fe;if(o.frameId&&o.parentComId){const Y=g.get({comId:o.parentComId,slotId:o.frameId,scope:u==null?void 0:u.parent});Y&&(fe={get _inputs(){return new Proxy({},{get(X,ne){return Y._inputRegs[ne]}})}})}const be=this.getClasses({style:d,id:_}),we=this.getSizeStyle({style:d,env:e}),Ie=this.getMarginStyle({style:d,env:e}),q={};if(["fixed","absolute"].includes(d.position)){const{top:Y,left:X,right:ne,bottom:oe}=d;(Y||isNumber(Y))&&(q.top=isNumber(Y)?Y+"px":Y),(oe||isNumber(oe))&&(q.bottom=isNumber(oe)?oe+"px":oe),(X||isNumber(X))&&(q.left=isNumber(X)?X+"px":X),(ne||isNumber(ne))&&(q.right=isNumber(ne)?ne+"px":ne),d.position==="fixed"?q.zIndex=1e3:d.position==="absolute"&&(q.zIndex=1);const{pxToVw:xe}=e;xe&&(typeof q.top=="string"&&q.top.indexOf("px")!==-1&&(q.top=pxToVw(q.top)),typeof q.bottom=="string"&&q.bottom.indexOf("px")!==-1&&(q.bottom=pxToVw(q.bottom)),typeof q.left=="string"&&q.left.indexOf("px")!==-1&&(q.left=pxToVw(q.left)),typeof q.right=="string"&&q.right.indexOf("px")!==-1&&(q.right=pxToVw(q.right)))}w.namespace==="mybricks.core-comlib.module"?this.component=Module:this.component=U.runtime,this.comDef=U,this.containerProps={id:_,key:_,style:{display:d.display,position:d.position||"relative",...q,...we,...Ie,...d.ext||{}}},this.containerClass=be;const de={id:_,env:{...e,pxToVw,spm:p?p==null?void 0:p(_,{title:I,namespace:w.namespace}):null},_env:n,data:b,name:l,title:I,slots:ge,propsStyle:d,inputs:C,outputs:k,_inputs:E,_outputs:K,_notifyBindings:N,parentSlot:fe,onError:a,logger:y};this.componentProps={...de,m:{...de,style:d}}},methods:{getStyleAry({env:n,def:e,style:t}){var y;const o=(y=n==null?void 0:n.themes)==null?void 0:y.comThemes;if(!o)return t.styleAry;let i;const{themesId:p}=t,{namespace:a}=e;if(p)if(p==="_defined")i=t.styleAry;else{const g=o[a];if(Array.isArray(g)){const u=g.find(({id:f})=>f===p);u&&(i=u.styleAry)}}else{const g=o[a];if(Array.isArray(g)){const u=g.find(({isDefault:f})=>f);u&&(i=u.styleAry)}}return i||t.styleAry},getClasses({style:n,id:e}){const t=[e,this.$style.com];return n.flex===1&&t.push(this.$style.flex),t.join(" ")},getSizeStyle({style:n,env:e}){const t={},{width:o,height:i}=n;o?isNumber(o)?t.width=o+"px":o&&(t.width=o):t.width="100%",isNumber(i)?t.height=i+"px":i&&(t.height=i);const{pxToVw:p}=e;return p&&(typeof t.width=="string"&&t.width.indexOf("px")!==-1&&(t.width=pxToVw(t.width)),typeof t.height=="string"&&t.height.indexOf("px")!==-1&&(t.height=pxToVw(t.height))),t},getMarginStyle({style:n,env:e}){const t={},{width:o,marginTop:i,marginLeft:p,marginRight:a,marginBottom:y}=n;isNumber(i)&&(t.marginTop=i+"px"),isNumber(p)&&(typeof o=="number"||p<0?t.marginLeft=p+"px":t.paddingLeft=p+"px"),isNumber(a)&&(typeof o=="number"||a<0?t.marginRight=a+"px":t.paddingRight=a+"px"),isNumber(y)&&(t.marginBottom=y+"px");const{pxToVw:g}=e;return g&&(typeof t.marginTop=="string"&&t.marginTop.indexOf("px")!==-1&&(t.marginTop=pxToVw(t.marginTop)),typeof t.marginLeft=="string"&&t.marginLeft.indexOf("px")!==-1&&(t.marginLeft=pxToVw(t.marginLeft)),typeof t.marginRight=="string"&&t.marginRight.indexOf("px")!==-1&&(t.marginRight=pxToVw(t.marginRight)),typeof t.marginBottom=="string"&&t.marginBottom.indexOf("px")!==-1&&(t.marginBottom=pxToVw(t.marginBottom)),typeof t.paddingLeft=="string"&&t.paddingLeft.indexOf("px")!==-1&&(t.paddingLeft=pxToVw(t.paddingLeft)),typeof t.paddingRight=="string"&&t.paddingRight.indexOf("px")!==-1&&(t.paddingRight=pxToVw(t.paddingRight))),t},getSlotProps(){}}};var _sfc_render$5=function n(){var e=this,t=e._self._c;return t("div",e._b({class:e.containerClass},"div",e.containerProps,!1),[t(e.component,e._b({tag:"component",scopedSlots:e._u([e._l(e.templateSlots,function(o){return{key:o.slotId,fn:function(i){return[t("SlotRender",e._b({},"SlotRender",{...o,params:i},!1))]}}})],null,!0)},"component",e.componentProps,!1))],1)},_sfc_staticRenderFns$5=[];const __cssModules$2={$style:style0$2};function _sfc_injectStyles$2(n){for(var e in __cssModules$2)this[e]=__cssModules$2[e]}var __component__$5=normalizeComponent(_sfc_main$5,_sfc_render$5,_sfc_staticRenderFns$5,!1,_sfc_injectStyles$2,null,null,null);const RenderCom=__component__$5.exports,slot="_slot_rwhgo_1",lyFlexColumn="_lyFlexColumn_rwhgo_6",lyFlexRow="_lyFlexRow_rwhgo_10",justifyContentFlexStart="_justifyContentFlexStart_rwhgo_14",justifyContentFlexCenter="_justifyContentFlexCenter_rwhgo_17",justifyContentFlexFlexEnd="_justifyContentFlexFlexEnd_rwhgo_20",justifyContentFlexSpaceAround="_justifyContentFlexSpaceAround_rwhgo_23",justifyContentFlexSpaceBetween="_justifyContentFlexSpaceBetween_rwhgo_26",alignItemsFlexStart="_alignItemsFlexStart_rwhgo_29",alignItemsFlexCenter="_alignItemsFlexCenter_rwhgo_32",alignItemsFlexFlexEnd="_alignItemsFlexFlexEnd_rwhgo_35",debugFocus="_debugFocus_rwhgo_38",error="_error_rwhgo_42",errorRT="_errorRT_rwhgo_47",tt="_tt_rwhgo_51",info="_info_rwhgo_57",style0$1={slot,lyFlexColumn,lyFlexRow,justifyContentFlexStart,justifyContentFlexCenter,justifyContentFlexFlexEnd,justifyContentFlexSpaceAround,justifyContentFlexSpaceBetween,alignItemsFlexStart,alignItemsFlexCenter,alignItemsFlexFlexEnd,debugFocus,error,errorRT,tt,info},_sfc_main$4={props:{env:{type:Object},propsStyle:{type:Object},_env:{type:Object},propsSlot:{type:Object},getComDef:{type:Function},registSpm:{type:Function},context:{type:Object},className:{type:String},onError:{type:Function},logger:{type:Object},root:{type:Boolean},scope:{type:Object},inputs:{type:Object},outputs:{type:Object},_inputs:{type:Object},_outputs:{type:Object},params:{type:Object}},created(){},computed:{comAry(){const{env:n,_env:e,propsSlot:t,context:o,getComDef:i,registSpm:p,onError:a,logger:y,scope:g,inputs:u,_inputs:f,outputs:j,_outputs:_}=this.$props,{comAry:w}=t,l=[];return w.forEach((h,b)=>{var H;const{id:I,def:d,name:C}=h,k=o.getComInfo(I),{hasPermission:E}=n,K=(H=k==null?void 0:k.model)==null?void 0:H.permissions;if(K&&typeof E=="function"&&!E(K.id))return;if(i(d)){const U=o.get({comId:I,scope:g,_ioProxy:{inputs:u,outputs:j,_inputs:f,_outputs:_}}),_e=(g?g.id:"")+b;l.push({id:I,props:{key:_e,com:h,getComDef:i,registSpm:p,context:o,scope:g,props:U,env:n,_env:e,onError:a,logger:y},component:RenderCom,name:C,inputs:U.inputsCallable,style:U.style})}else console.error(`组件 (namespace = {${d.namespace}}）未找到.`)}),l},classes(){const{root:n,className:e,params:t,propsStyle:o}=this.$props,p=(t==null?void 0:t.style)||(t==null?void 0:t._style)||o;return`${this.calSlotClasses(p||{})}${n&&e?` ${e}`:""}`},styles(){const{root:n,propsStyle:e,params:t}=this.$props,o=(t==null?void 0:t.style)||(t==null?void 0:t._style),i=o||e;return{...this.calSlotStyles(i||{},!!o,n),...e}}},methods:{calSlotStyles(n,e,t){const{paddingLeft:o,paddingTop:i,paddingRight:p,paddingBottom:a,background:y,backgroundColor:g,backgroundImage:u,backgroundPosition:f,backgroundRepeat:j,backgroundSize:_,...w}=n;let l={paddingLeft:o||0,paddingTop:i||0,paddingRight:p||0,paddingBottom:a||0,backgroundColor:g,backgroundImage:u,backgroundPosition:f,backgroundRepeat:j,backgroundSize:_};if(y)if(typeof y=="object"){const{background:b,backgroundImage:I,backgroundColor:d,backgroundRepeat:C,backgroundSize:k}=y;l.backgroundRepeat=C,l.backgroundSize=k,b?l.background=b:(l.backgroundImage=I,l.backgroundColor=d)}else l.background=y;return e&&(l=Object.assign(l,w)),l},calSlotClasses(n){var i,p;const e=this.$style,t=[e.slot,"slot"],o=n;if(o){((i=o.layout)==null?void 0:i.toLowerCase())=="flex-column"?t.push(e.lyFlexColumn):((p=o.layout)==null?void 0:p.toLowerCase())=="flex-row"&&t.push(e.lyFlexRow);const a=o.justifyContent;a&&(a.toUpperCase()==="FLEX-START"?t.push(e.justifyContentFlexStart):a.toUpperCase()==="CENTER"?t.push(e.justifyContentFlexCenter):a.toUpperCase()==="FLEX-END"?t.push(e.justifyContentFlexFlexEnd):a.toUpperCase()==="SPACE-AROUND"?t.push(e.justifyContentFlexSpaceAround):a.toUpperCase()==="SPACE-BETWEEN"&&t.push(e.justifyContentFlexSpaceBetween));const y=o.alignItems;y&&(y.toUpperCase()==="FLEX-START"?t.push(e.alignItemsFlexStart):y.toUpperCase()==="CENTER"?t.push(e.alignItemsFlexCenter):y.toUpperCase()==="FLEX-END"&&t.push(e.alignItemsFlexFlexEnd))}return t.join(" ")}}};var _sfc_render$4=function n(){var e=this,t=e._self._c;return t("div",{class:e.classes,style:e.styles,attrs:{"data-isslot":"1"}},[e._l(e.comAry,function(o){return t(o.component,e._b({key:o.id,tag:"component"},"component",o.props,!1))}),t("div")],2)},_sfc_staticRenderFns$4=[];const __cssModules$1={$style:style0$1};function _sfc_injectStyles$1(n){for(var e in __cssModules$1)this[e]=__cssModules$1[e]}var __component__$4=normalizeComponent(_sfc_main$4,_sfc_render$4,_sfc_staticRenderFns$4,!1,_sfc_injectStyles$1,null,null,null);const RenderSlot=__component__$4.exports,_sfc_main$3={components:{RenderSlot},props:{json:{type:Object},opts:{type:Object},propsStyle:{type:Object},className:{type:String},root:{type:Boolean}},created(){const{json:n,opts:e}=this.$props;this.hasUi=n.rtType!=="js";let t={};e.comDefs&&Object.assign(t,e.comDefs);let o=[...window.__comlibs_edit_||[],...window.__comlibs_rt_||[]];o.push(coreLib),o.forEach(i=>{const p=i.comAray;p&&Array.isArray(p)&&this.regAry(p,t)}),this.comDefs=t,e.env.renderModule||(e.env.renderModule=(i,p)=>({json:i,opts:{...p,env:e.env}}));try{let i,p=!0;const a=executor({json:n,getComDef:this.getComDef,events:e.events,env:e.env,ref(y){i=y,typeof e.ref=="function"&&(e.ref(y),p=!1)},onError:this.onError,debug:e.debug,debugLogger:e.debugLogger,logger:this.logger,scenesOperate:e.scenesOperate},{observable:e.observable||Vue.observable});this.context=a,this.refs=i,this.activeTriggerInput=p}catch(i){throw console.error(i),new Error("导出的JSON.script执行异常.")}},mounted(){const{opts:n,json:e}=this.$props;if(!n.disableAutoRun){if(this.activeTriggerInput){const{inputs:t}=this.refs,o=e.inputs;t&&Array.isArray(o)&&o.forEach(i=>{const{id:p,mockData:a}=i;let y;if(n.debug&&typeof a<"u")try{y=JSON.parse(decodeURIComponent(a))}catch{y=a}t[p](y)})}this.refs.run()}},computed:{logger(){return{...console}},onError(){return n=>{console.error(n)}},props(){const{json:n,opts:e,propsStyle:t,className:o,root:i=!0}=this.$props;return{env:e.env,propsStyle:t,_env:e._env,registSpm:e.registSpm,propsSlot:n.slot,getComDef:this.getComDef,context:this.context,className:o,onError:this.onError,logger:this.logger,root:i}}},methods:{regAry(n,e){n.forEach(t=>{t.comAray?this.regAry(t.comAray,e):e[`${t.namespace}-${t.version}`]=t})},getComDef(n){const{comDefs:e}=this,t=e[n.namespace+"-"+n.version];if(!t){const o=[];for(let i in e)i.startsWith(n.namespace+"-")&&o.push(e[i]);if(o&&o.length>0){o.sort((p,a)=>compareVersion(p.version,a.version));const i=o[0];return console.warn(`【Mybricks】组件${n.namespace+"@"+n.version}未找到，使用${i.namespace}@${i.version}代替.`),i}else throw console.log(e),new Error(`组件${n.namespace+"@"+n.version}未找到，请确定是否存在该组件以及对应的版本号.`)}return t}}};var _sfc_render$3=function n(){var e=this,t=e._self._c;return e.hasUi?t("RenderSlot",e._b({},"RenderSlot",e.props,!1)):e._e()},_sfc_staticRenderFns$3=[],__component__$3=normalizeComponent(_sfc_main$3,_sfc_render$3,_sfc_staticRenderFns$3,!1,null,null,null,null);const Main=__component__$3.exports,main$1="_main_1oukw_14",slipInto="_slipInto_1oukw_1",style0={main:main$1,slipInto},_sfc_main$2={components:{Main},props:{json:{type:Object},opts:{type:Object}},data(){return{count:0,popupIds:[],pageScenes:[]}},created(){const{json:n,opts:e}=this.$props;if(e.sceneId){const g=n.scenes.findIndex(u=>u.id===e.sceneId);if(g!==-1){const u=n.scenes.splice(g,1);n.scenes.unshift(...u),u[0].type==="popup"&&this.setPopupIds([u[0].id])}}const t=[];n.scenes.forEach((g,u)=>{g.type==="popup"?u||this.setPopupIds([g.id]):t.push(g)}),this.setPageScenes(t);const{modules:o,definedComs:i}=n;if(e.env.getDefinedComJSON||(e.env.getDefinedComJSON=g=>i[g].json),e.env.getModuleJSON||(e.env.getModuleJSON=g=>{var l;const u=(l=o==null?void 0:o[g])==null?void 0:l.json;if(!u)return u;const{global:f}=n;let j={},_={},w={};return f&&(j=f.comsReg,_=f.consReg,w=f.pinRels,Object.keys(j).forEach(h=>{j[h].global=!0})),Object.assign(u.coms,j),Object.assign(u.cons,_),Object.assign(u.pinRels,w),u}),this.scenesMap=n.scenes.reduce((g,u,f)=>{var j;return{...g,[u.id]:{show:f===0,todo:[],json:u,disableAutoRun:!!f,useEntryAnimation:!1,type:((j=u.slot)==null?void 0:j.showType)||u.type}}},{}),this.scenesOperateInputsTodo={},this.themes=n.themes,this.permissions=n.permissions||[],this.globalVarMap={},e.ref){const g=e.ref;e.ref=u=>f=>(u(f),g.call(e,f))}else e.ref=g=>u=>{g(u)};const p={},a=[],{global:y}=n;if(y){const{fxFrames:g}=y;Array.isArray(g)&&g.forEach(u=>{var I;const{id:f}=u,j={};p[f]=j;const _={open({todo:d,frameId:C,parentScope:k}){const E=p[C];E!=null&&E._refs&&(E.parentScope=k,E._refs.inputs[d.pinId](d.value,void 0,!1),E._refs.run())},inputs({frameId:d,parentScope:C,value:k,pinId:E}){const K=scenesMap[d];K?(K.parentScope=C,K._refs?K._refs.inputs[E](k):K.todo=K.todo.concat({type:"inputs",todo:{pinId:E,value:k}})):scenesOperateInputsTodo[d]?scenesOperateInputsTodo[d].todo.push({frameId:d,parentScope:C,value:k,pinId:E}):scenesOperateInputsTodo[d]={parentScope:C,todo:[{value:k,pinId:E}]}},_notifyBindings(d,C){const{bindingsTo:k}=C.model;if(k)for(let E in k)for(let K in scenesMap){const N=scenesMap[K];if(N.json.coms[E])if(N._refs)this._notifyBindings(N._refs,E,k[E],d);else{const U=k[E];N.todo=N.todo.concat({type:"globalVar",todo:{comId:E,bindings:U,value:d}})}}},getGlobalComProps(d){return scenesMap[n.scenes[0].id]._refs.get({comId:d})},exeGlobalCom({com:d,value:C,pinId:k}){const E=d.id;this.globalVarMap[E]=C,Object.keys(scenesMap).forEach(N=>{const H=scenesMap[N];if(H.show&&H._refs){const U=H._refs.get({comId:E});U&&U.outputs[k](C,!0,null,!0)}});const K=e.env._context.getRefsMap();Object.entries(K).forEach(([N,H])=>{const U=H.get({comId:E});U&&U.outputs[k](C,!0,null,!0)})}},w={...e,env:{...e.env,canvas:Object.assign({id:f,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(d,C,k)=>{var K;let E=scenesMap[d];if(!E){if(typeof e.scenesLoader!="function"){console.error(`缺少场景信息: ${d}`);return}const N=await e.scenesLoader({id:d});if(E={disableAutoRun:!1,json:N,show:!1,parentScope:null,todo:[],type:((K=N.slot)==null?void 0:K.showType)||N.type,useEntryAnimation:!1},scenesMap[d]=E,N.type==="popup"||setPageScenes(H=>[...H,N]),scenesOperateInputsTodo[d]){const{parentScope:H,todo:U}=scenesOperateInputsTodo[d];E.parentScope=H,U.forEach(({value:_e,pinId:ge,parentScope:fe})=>{E.todo=E.todo.concat({type:"inputs",todo:{pinId:ge,value:_e}})})}}k?Object.entries(scenesMap).forEach(([N,H])=>{N===d?(k==="blank"?H.useEntryAnimation=!0:H.useEntryAnimation=!1,H.show=!0,H.type==="popup"?this.setPopupIds([...this.popupIds,d]):setCount(U=>U+1)):(H.show=!1,H.type==="popup"?this.setPopupIds(this.popupIds.filter(U=>U!==H.json.id)):setCount(U=>U+1))}):E.show||(k==="blank"?E.useEntryAnimation=!0:E.useEntryAnimation=!1,E.show=!0,E.type==="popup"?this.setPopupIds([...this.popupIds,d]):setCount(N=>N+1))}},(I=e.env)==null?void 0:I.canvas)},disableAutoRun:!0,ref:e.ref(d=>{j._refs=d;const{inputs:C,outputs:k}=d;u.outputs.forEach(E=>{k(E.id,K=>{var N;(N=j.parentScope)==null||N.outputs[E.id](K)})})}),_env:{loadCSSLazy(){},currentScenes:{close(){}}},scenesOperate:_};let l=y.comsReg,h=y.consReg,b=y.pinRels;Object.keys(l).forEach(d=>{l[d].global=!0}),Object.assign(u.coms,l),Object.assign(u.cons,h),Object.assign(u.pinRels,b),a.push({key:f,component:Main,json:{...u,rtType:"js"},options:w})})}this.fxFramesMap=p,this.fxFramesJsx=a},computed:{scenes(){const{pageScenes:n,scenesMap:e}=this;if(!n.length)return[];const{json:t}=this.$props,{global:o}=t;let i={},p={},a={};return o&&(i=o.comsReg,p=o.consReg,a=o.pinRels,Object.keys(i).forEach(y=>{i[y].global=!0})),n.map((y,g)=>{const{id:u}=y;Object.assign(y.coms,i),Object.assign(y.cons,p),Object.assign(y.pinRels,a);const f=e[u];return{show:f.show,key:u,json:{...y,scenesMap:e},opts:this.options(u),className:f.useEntryAnimation?$style.main:"",style:f.type==="popup"?{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}:{}}})},popups(){const{popupIds:n,scenesMap:e}=this;if(!n.length)return[];const{json:t}=this.$props,{global:o}=t;let i={},p={},a={};return o&&(i=o.comsReg,p=o.consReg,a=o.pinRels,Object.keys(i).forEach(y=>{i[y].global=!0})),n.map(y=>{const u=e[y].json,{id:f}=u;return Object.assign(u.coms,i),Object.assign(u.cons,p),Object.assign(u.pinRels,a),{key:u.id,json:{...u,scenesMap:e},opts:this.options(f),style:{position:"absolute",top:0,left:0,backgroundColor:"#ffffff00"}}})}},methods:{setCount(n){this.count=n},setPopupIds(n){this.popupIds=n},setPageScenes(n){this.pageScenes=n},options(n){var u;const{opts:e}=this.$props,{scenesMap:t,themes:o,permissions:i}=this,p=this,a=t[n],y=e.env.hasPermission,g={open({todo:f,frameId:j,parentScope:_}){const w=t[j];if(w)w.show||(w.show=!0,w.todo=w.todo.concat({type:"inputs",todo:f}),w.parentScope=_,w.type==="popup"?p.setPopupIds([...p.popupIds,j]):setCount(l=>l+1));else{const l=fxFramesMap[j];l!=null&&l._refs&&(l.parentScope=_,l._refs.inputs[f.pinId](f.value,void 0,!1),l._refs.run())}},inputs({frameId:f,parentScope:j,value:_,pinId:w}){const l=t[f];l?(l.parentScope=j,l._refs?l._refs.inputs[w](_):l.todo=l.todo.concat({type:"inputs",todo:{pinId:w,value:_}})):scenesOperateInputsTodo[f]?scenesOperateInputsTodo[f].todo.push({frameId:f,parentScope:j,value:_,pinId:w}):scenesOperateInputsTodo[f]={parentScope:j,todo:[{value:_,pinId:w}]}},_notifyBindings(f,j){const{bindingsTo:_}=j.model;if(_)for(let w in _)for(let l in t){const h=t[l];if(h.json.coms[w])if(h._refs)this._notifyBindings(h._refs,w,_[w],f);else{const I=_[w];h.todo=h.todo.concat({type:"globalVar",todo:{comId:w,bindings:I,value:f}})}}},getGlobalComProps(f){return t[json.scenes[0].id]._refs.get({comId:f})},exeGlobalCom({com:f,value:j,pinId:_}){const w=f.id;p.globalVarMap[w]=j,Object.keys(t).forEach(h=>{const b=t[h];if(b.show&&b._refs){const I=b._refs.get({comId:w});I&&I.outputs[_](j,!0,null,!0)}});const l=e.env._context.getRefsMap();Object.entries(l).forEach(([h,b])=>{const I=b.get({comId:w});I&&I.outputs[_](j,!0,null,!0)})}};return{...e,env:{...e.env,themes:o,permissions:i,hasPermission:typeof y=="function"?f=>{if(typeof f=="string"){const j=i.find(_=>_.id===f);return y({permission:j})}return y(f)}:null,canvas:Object.assign({id:n,type:(window==null?void 0:window.document.body.clientWidth)<=414?"mobile":"pc",open:async(f,j,_)=>{var l;let w=t[f];if(!w){if(typeof e.scenesLoader!="function"){console.error(`缺少场景信息: ${f}`);return}const h=await e.scenesLoader({id:f});if(w={disableAutoRun:!1,json:h,show:!1,parentScope:null,todo:[],type:((l=h.slot)==null?void 0:l.showType)||h.type,useEntryAnimation:!1},t[f]=w,h.type==="popup"||setPageScenes(b=>[...b,h]),scenesOperateInputsTodo[f]){const{parentScope:b,todo:I}=scenesOperateInputsTodo[f];w.parentScope=b,I.forEach(({value:d,pinId:C,parentScope:k})=>{w.todo=w.todo.concat({type:"inputs",todo:{pinId:C,value:d}})})}}_?Object.entries(t).forEach(([h,b])=>{h===f?(_==="blank"?b.useEntryAnimation=!0:b.useEntryAnimation=!1,b.show=!0,b.type==="popup"?p.setPopupIds([...p.popupIds,f]):setCount(I=>I+1)):(b.show=!1,b.type==="popup"?p.setPopupIds(p.popupIds.filter(I=>I!==b.json.id)):setCount(I=>I+1))}):w.show||(_==="blank"?w.useEntryAnimation=!0:w.useEntryAnimation=!1,w.show=!0,w.type==="popup"?p.setPopupIds([...p.popupIds,f]):setCount(h=>h+1))}},(u=e.env)==null?void 0:u.canvas)},get disableAutoRun(){return a.disableAutoRun},ref:e.ref(f=>{a._refs=f;const j=a.todo,{inputs:_,outputs:w}=f,l=a.disableAutoRun;a.json.outputs.forEach(h=>{w(h.id,b=>{var I;a.show=!1,a.todo=[],a._refs=null,(I=a.parentScope)==null||I.outputs[h.id](b),a.parentScope=null,a.type==="popup"?p.setPopupIds(p.popupIds.filter(d=>d!==a.json.id)):setCount(d=>d+1)})}),j.length?(j.forEach(({type:h,todo:b})=>{if(h==="inputs")Promise.resolve().then(()=>{_[b.pinId](b.value,n)});else if(h==="globalVar"){const{comId:I,value:d,bindings:C}=b;p._notifyBindings(f,I,C,d)}}),a.todo=[]):l||Promise.resolve().then(()=>{var h,b;a.disableAutoRun=!0,(b=(h=a.json.inputs)==null?void 0:h.forEach)==null||b.call(h,I=>{const{id:d,mockData:C}=I;let k;if(e.debug&&typeof C<"u")try{k=JSON.parse(decodeURIComponent(C))}catch{k=C}_[d](k)})}),l&&Promise.resolve().then(()=>{f.run()}),Object.entries(p.globalVarMap).forEach(([h,b])=>{const I=a._refs.get({comId:h});I&&I.outputs.changed(b,!0,null,!0)})}),_env:{loadCSSLazy(){},currentScenes:{close(){a.show=!1,a.todo=[],a._refs=null,a.type==="popup"?(console.log(p,"that"),p.setPopupIds(p.popupIds.filter(f=>f!==a.json.id))):setCount(f=>f+1)}}},scenesOperate:g}},_notifyBindings(n,e,t,o){const i=n.get({comId:e});i&&Array.isArray(t)&&t.forEach(p=>{let a=i;const y=p.split(".");y.forEach((g,u)=>{u!==y.length-1?a=a[g]:a[g]=o})})}}};var _sfc_render$2=function n(){var e=this,t=e._self._c;return t("div",[e._l(e.fxFramesJsx,function(o){return t(o.component,{key:o.key,tag:"component",attrs:{json:o.json,opts:o.options}})}),e._l(e.scenes,function(o){return o.show?t("Main",{key:o.key,attrs:{json:o.json,opts:o.opts,className:o.className,propsStyle:o.style}}):e._e()}),e._l(e.popups,function(o){return t("Main",{key:o.key,attrs:{json:o.json,opts:o.opts,className:o.className,propsStyle:o.style}})})],2)},_sfc_staticRenderFns$2=[];const __cssModules={$style:style0};function _sfc_injectStyles(n){for(var e in __cssModules)this[e]=__cssModules[e]}var __component__$2=normalizeComponent(_sfc_main$2,_sfc_render$2,_sfc_staticRenderFns$2,!1,_sfc_injectStyles,null,null,null);const MultiScene=__component__$2.exports;class Context{constructor(){He(this,"_refsMap",{})}setRefs(e,t){this._refsMap[e]=t}getRefsMap(){return this._refsMap}}const _sfc_main$1={functional:!0,render(n,{props:e}){const{json:t,opts:o}=e;if(!t)return null;o.env._context||(o.env._context=new Context);const i=Array.isArray(t.scenes),p=i?MultiScene:Main;return!i&&t.type==="module"&&(e.root=!1),n(p,{props:e},[])}},_sfc_render$1=null,_sfc_staticRenderFns$1=null;var __component__$1=normalizeComponent(_sfc_main$1,_sfc_render$1,_sfc_staticRenderFns$1,!1,null,null,null,null);const Render=__component__$1.exports,_sfc_main={components:{Render},props:{json:{type:Object},opts:{type:Object}}};var _sfc_render=function n(){var e=this,t=e._self._c;return t("Render",e._b({},"Render",this.$props,!1))},_sfc_staticRenderFns=[],__component__=normalizeComponent(_sfc_main,_sfc_render,_sfc_staticRenderFns,!1,null,null,null,null);const App=__component__.exports,name="@mybricks/render-web-vue2",version="0.0.4",description="",main="dist/index.mjs",scripts={dev:"vite",build:"vite build --config vite.build.js"},keywords=[],author="",license="ISC",dependencies={"@mybricks/comlib-core":"^0.0.36",vue:"^2.7.14"},devDependencies={"@vitejs/plugin-vue2":"^2.2.0",less:"^4.2.0",vite:"^4.4.9"},pkg={name,version,description,main,scripts,keywords,author,license,dependencies,devDependencies};console.log(`%c ${pkg.name} %c@${pkg.version}`,"color:#FFF;background:#fa6400","","");function render(n,e){return Vue.extend({render:t=>t(App,{props:{json:n,opts:e}})})}window["mybricks-render-vue2"]=function n({json:e,opts:t},o){new Vue({render:i=>i(App,{props:{json:e,opts:t}},[])}).$mount(o)},exports.render=render,Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})});
